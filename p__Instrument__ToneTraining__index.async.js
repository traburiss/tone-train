"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[602],{30525:function(Be,re,r){r.r(re),r.d(re,{default:function(){return De}});var de=r(26068),d=r.n(de),ge=r(48305),p=r.n(ge),ve=r(99788),a=r(67849),j=r(40624),ae=r(24486),W=r(97375),he=r(1501),V=r(99752),xe=r(31770),Q=r(82238),oe=r(45803),v=r(75271),t=r(52676),be=function(){var e=(0,Q.useIntl)();return(0,t.jsxs)(oe.Z,{title:e.formatMessage({id:"common.basic-settings"}),className:"mb-3 sm:mb-6",children:[(0,t.jsx)(j.A.Group,{children:(0,t.jsx)(ae.Z.Group,{name:"instrumentName",label:e.formatMessage({id:"common.instrument-choice"}),tooltip:e.formatMessage({id:"common.instrument-choice.tooltip"}),radioType:"button",fieldProps:{buttonStyle:"solid",size:"middle"},options:a.qL.map(function(u){return d()(d()({},u),{},{label:e.formatMessage({id:u.label})})})})}),(0,t.jsxs)(j.A.Group,{children:[(0,t.jsx)(ae.Z.Group,{name:"loopCountType",label:e.formatMessage({id:"common.loop-count"}),tooltip:e.formatMessage({id:"common.loop-count.tooltip"}),radioType:"button",fieldProps:{buttonStyle:"solid",size:"middle"},options:a.qx.map(function(u){return d()(d()({},u),{},{label:e.formatMessage({id:u.label},{n:u.value})})})}),(0,t.jsx)(W.Z,{name:["loopCountType"],children:function(b){var m=b.loopCountType;return m==="custom"&&(0,t.jsx)(he.Z,{name:"loopCountCustom",label:" ",width:"xs",placeholder:e.formatMessage({id:"common.count"}),min:1,max:1e3,fieldProps:{precision:0}})}})]}),(0,t.jsx)(j.A.Group,{children:(0,t.jsx)(V.Z,{name:"random",label:e.formatMessage({id:"common.random-play"}),tooltip:e.formatMessage({id:"common.random-play.tooltip"})})}),(0,t.jsxs)(j.A.Group,{children:[(0,t.jsx)(V.Z,{name:"referenceNoteEnabled",label:e.formatMessage({id:"common.reference-note"}),tooltip:e.formatMessage({id:"common.reference-note.tooltip"})}),(0,t.jsx)(W.Z,{name:["referenceNoteEnabled"],children:function(b){var m=b.referenceNoteEnabled;return m&&(0,t.jsx)(xe.Z,{name:"referenceNote",label:" ",width:"xs",options:a.cS,placeholder:e.formatMessage({id:"common.reference-note.placeholder"})})}})]})]})},pe=be,$=r(84611),je=function(){var e=(0,Q.useIntl)(),u=(0,a.L3)(e);return(0,t.jsxs)(oe.Z,{title:e.formatMessage({id:"common.playback-settings"}),className:"mb-3 sm:mb-6",children:[(0,t.jsxs)(j.A.Group,{title:e.formatMessage({id:"common.time-settings"}),children:[(0,t.jsx)($.Z,{name:"toneDuration",label:e.formatMessage({id:"common.tone-duration"}),width:"md",min:a.Qx,max:a.Zf,step:a.LB,fieldProps:{tooltip:{formatter:u}}}),(0,t.jsx)($.Z,{name:"toneWait",label:e.formatMessage({id:"common.tone-wait"}),width:"md",min:a.Qx,max:a.Zf,step:a.LB,fieldProps:{tooltip:{formatter:u}}})]}),(0,t.jsxs)(j.A.Group,{title:e.formatMessage({id:"common.tts-settings"}),children:[(0,t.jsx)(V.Z,{name:"ttsEnable",label:e.formatMessage({id:"common.tts-enable"}),tooltip:e.formatMessage({id:"common.tts-enable.tooltip"})}),(0,t.jsx)(W.Z,{name:["ttsEnable"],children:function(m){var h=m.ttsEnable;return h&&(0,t.jsx)($.Z,{name:"ttsRate",label:e.formatMessage({id:"common.tts-rate"}),tooltip:e.formatMessage({id:"common.tts-rate.tooltip"}),width:"md",min:.5,max:4,step:.1,fieldProps:{tooltip:{formatter:function(T){return"".concat(T,"x ").concat(e.formatMessage({id:"common.tone-duration"}))}}}})}}),(0,t.jsx)(W.Z,{name:["ttsEnable"],children:function(m){var h=m.ttsEnable;return h&&(0,t.jsx)($.Z,{name:"ttsWait",label:e.formatMessage({id:"common.tts-wait"}),width:"md",min:a.Qx,max:a.Zf,step:a.LB,fieldProps:{tooltip:{formatter:u}}})}})]}),(0,t.jsx)(W.Z,{name:["ttsEnable"],children:function(m){var h=m.ttsEnable;return h&&(0,t.jsxs)(j.A.Group,{children:[(0,t.jsx)(V.Z,{name:"ttsSolfege",label:e.formatMessage({id:"common.tts-solfege"}),tooltip:e.formatMessage({id:"common.tts-solfege.tooltip"})}),(0,t.jsx)(W.Z,{name:["ttsSolfege"],children:function(T){var M=T.ttsSolfege;return M&&(0,t.jsx)($.Z,{name:"ttsSolfegeWait",label:e.formatMessage({id:"common.tts-solfege-wait"}),width:"sm",min:a.Qx,max:a.Zf,step:a.LB,fieldProps:{tooltip:{formatter:u}}})}})]})}}),(0,t.jsx)(W.Z,{name:["ttsEnable"],children:function(m){var h=m.ttsEnable;return h&&(0,t.jsxs)(j.A.Group,{children:[(0,t.jsx)(V.Z,{name:"ttsNotation",label:e.formatMessage({id:"common.tts-notation"}),tooltip:e.formatMessage({id:"common.tts-notation.tooltip"})}),(0,t.jsx)(W.Z,{name:["ttsNotation"],children:function(T){var M=T.ttsNotation;return M&&(0,t.jsx)($.Z,{name:"ttsNotationWait",label:e.formatMessage({id:"common.tts-notation-wait"}),width:"sm",min:a.Qx,max:a.Zf,step:a.LB,fieldProps:{tooltip:{formatter:u}}})}})]})}})]})},Se=je,ye=r(90228),w=r.n(ye),Te=r(87999),se=r.n(Te),Ne=r(7033),Me=r(32613),H=r(85747),_=r(21017),Ce=r(82773),Pe=r(81735),Ze=r(1073),Ee=r(60672),U=r(55248),Ge={trainPlayInfo:"trainPlayInfo___cZ8NU"},y=null,Le=function(e){var u=(0,v.useState)(!0),b=p()(u,2),m=b[0],h=b[1],A=(0,v.useState)(!1),T=p()(A,2),M=T[0],te=T[1],ne=(0,v.useState)("..."),F=p()(ne,2),C=F[0],D=F[1],Y=(0,v.useState)(!1),k=p()(Y,2),J=k[0],B=k[1],N=Pe.ZP.useNotification(),o=p()(N,2),f=o[1],i=(0,Q.useIntl)(),c=v.useRef(0),P=v.useRef(0),O=function(g){var x=g,E={Do:"Duo",Re:"Rui",Fa:"Fa",Sol:"Suo",La:"La",Si:"Xi",\u5347:"Sheng ",\u964D:"Jiang "};Object.entries(E).forEach(function(L){var s=p()(L,2),I=s[0],z=s[1],R=new RegExp(I,"g");x=x.replace(R,z)}),x=x.replace(/#/g," sharp").replace(/m($|7)/g," minor$1").replace(/maj/g," major ").replace(/sus/g," suspended ").replace(/\//g," over ").replace(/([A-G])(\d)/g,"$1 $2").trim();var G=new SpeechSynthesisUtterance(x),X=e.ttsRate||1;G.rate=1/X,window.speechSynthesis.speak(G)},Z=v.useRef(e);Z.current=e;var le=function(){var l=se()(w()().mark(function g(x,E){var G;return w()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return y!==null&&(G=[],Z.current.toneType==="GuitarChords"&&(G=(0,H.UV)(x)),G.length>0?y.triggerAttackRelease(G,E/1e3):y.triggerAttackRelease(x,E/1e3)),L.abrupt("return",new Promise(function(s){setTimeout(s,E)}));case 2:case"end":return L.stop()}},g)}));return function(x,E){return l.apply(this,arguments)}}(),ue=v.useMemo(function(){var l=(e.toneDuration||0)+(e.toneWait||0)+(e.ttsWait||0)+(e.referenceNoteEnabled?(e.toneDuration||0)+(e.toneWait||0):0),g=0;return e.ttsEnable&&(g+=1e3,Z.current.toneType!=="GuitarChords"&&(e.ttsSolfege&&(g+=(e.ttsSolfegeWait||0)+1e3),e.ttsNotation&&(g+=(e.ttsNotationWait||0)+1e3))),Math.max(l+g,500)},[e.toneDuration,e.toneWait,e.ttsWait,e.referenceNoteEnabled,e.ttsEnable,e.ttsSolfege,e.ttsSolfegeWait,e.ttsNotation,e.ttsNotationWait]);(0,v.useEffect)(function(){if(m||!e.open){y!==null&&y.triggerRelease(U.zO());return}var l=!1,g=null,x=null,E=function(){var X=se()(w()().mark(function L(){var s,I,z,R,fe,K,ce,q;return w()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!l){n.next=2;break}return n.abrupt("return");case 2:if(s=Z.current,I=s.toneList.length,I!==0){n.next=6;break}return n.abrupt("return");case 6:if(z=0,s.random?z=Math.floor(Math.random()*I):z=c.current,R=s.toneList[z],D(R),B(!1),s.random){n.next=21;break}if(c.current++,!(c.current>=I)){n.next=19;break}if(c.current=0,P.current++,!(Number(s.loopCount)>0&&P.current>=Number(s.loopCount))){n.next=19;break}return h(!0),n.abrupt("return");case 19:n.next=28;break;case 21:if(c.current++,!(c.current>=I)){n.next=28;break}if(c.current=0,P.current++,!(Number(s.loopCount)>0&&P.current>=Number(s.loopCount))){n.next=28;break}return h(!0),n.abrupt("return");case 28:if(!(s.referenceNoteEnabled&&s.referenceNote)){n.next=37;break}if(!l){n.next=31;break}return n.abrupt("return");case 31:return n.next=33,le(s.referenceNote,s.toneDuration);case 33:if(!l){n.next=35;break}return n.abrupt("return");case 35:return n.next=37,new Promise(function(S){x=setTimeout(S,s.toneWait)});case 37:if(!l){n.next=39;break}return n.abrupt("return");case 39:return n.next=41,le(R,s.toneDuration);case 41:if(!l){n.next=43;break}return n.abrupt("return");case 43:if(s.ttsEnable||B(!0),!l){n.next=46;break}return n.abrupt("return");case 46:if(!s.ttsEnable){n.next=69;break}return n.next=49,new Promise(function(S){g=setTimeout(S,s.toneWait||200)});case 49:if(!l){n.next=51;break}return n.abrupt("return");case 51:if(B(!0),O(R),Z.current.toneType!=="GuitarChords"){n.next=55;break}return n.abrupt("return");case 55:if(!s.ttsSolfege){n.next=62;break}return n.next=58,new Promise(function(S){g=setTimeout(S,s.ttsSolfegeWait||500)});case 58:if(!l){n.next=60;break}return n.abrupt("return");case 60:fe=(0,H.jP)(R),K=fe.solfege,K&&(O(K),D(function(S){return"".concat(S," ").concat(K)}));case 62:if(!s.ttsNotation){n.next=69;break}return n.next=65,new Promise(function(S){g=setTimeout(S,s.ttsNotationWait||500)});case 65:if(!l){n.next=67;break}return n.abrupt("return");case 67:ce=(0,H.jP)(R),q=ce.number,q&&(O(q),D(function(S){return"".concat(S," ").concat(q)}));case 69:case"end":return n.stop()}},L)}));return function(){return X.apply(this,arguments)}}();E();var G=setInterval(E,ue);return function(){l=!0,clearInterval(G),g&&clearTimeout(g),x&&clearTimeout(x),y!==null&&y.triggerRelease(U.zO())}},[m,e.open,ue]),(0,v.useEffect)(function(){e.open&&(c.current=0,P.current=0,D("..."),B(!1),te(!1),y||(y=new U.v2(U.WV).toDestination()),(0,_.pr)(e.instrumentName).then(function(l){y=l}).catch(function(l){console.error("\u52A0\u8F7D\u97F3\u8272\u9519\u8BEF\uFF0C\u964D\u7EA7\u4F7F\u7528Synth",l)}),h(!1))},[e.open]);var Oe=function(){h(!m)},Ie=(0,Me.u)(e.instrumentName),me=Ie.status,$e=function(){return me==="loading"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:i.formatMessage({id:"tone-training.current-tone"})}),(0,t.jsx)("div",{className:"text-yellow-600 text-sm",children:i.formatMessage({id:"tone-training.instrument-loading-hint"})})]}):me==="error"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:i.formatMessage({id:"tone-training.current-tone"})}),(0,t.jsx)("div",{className:"text-red-600 text-sm",children:i.formatMessage({id:"tone-training.instrument-error-hint"})})]}):i.formatMessage({id:"tone-training.current-tone"})};return(0,t.jsxs)(t.Fragment,{children:[f,(0,t.jsx)(Ze.Z,{open:e.open,destroyOnHidden:!0,width:"90%",style:{maxWidth:800},centered:!0,maskClosable:!1,okText:m?i.formatMessage({id:"tone-training.resume"}):i.formatMessage({id:"tone-training.pause"}),onOk:Oe,cancelText:i.formatMessage({id:"tone-training.stop"}),onCancel:function(){e.onCancel()},loading:M,title:M?i.formatMessage({id:"tone-training.instrument-loading"}):i.formatMessage({id:"tone-training.title"}),children:(0,t.jsx)(Ee.ZP,{className:Ge.trainPlayInfo,title:$e(),subTitle:(0,t.jsx)("div",{className:"text-2xl sm:text-4xl flex items-center justify-center gap-2",children:J?C:"?"}),icon:J&&H.YD[C]?(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(Ne.Z,{name:C,fingering:H.YD[C],width:100,height:140})}):(0,t.jsx)("div",{className:"flex items-center justify-center h-[140px]",children:(0,t.jsx)(Ce.Z,{className:"text-6xl text-blue-400 animate-pulse"})})})})]})},We=Le,ie=r(6946),Re=r(5318),Ae=r(21004),Fe=function(){var e=(0,v.useState)(a.sO),u=p()(e,2),b=u[0],m=u[1],h=(0,v.useState)(!1),A=p()(h,2),T=A[0],M=A[1],te=j.A.useForm(),ne=p()(te,1),F=ne[0],C=(0,Q.useIntl)(),D=j.A.useWatch("instrumentName",F)||a.OG;(0,v.useEffect)(function(){(0,_.pr)(D).catch(console.error)},[D]);var Y=function(o,f){if(console.log("flattenGroupedTones input:",{groups:o,toneType:f}),f==="GuitarChords"){var i=o.chords||[];return console.log("Returning chords:",i),i}var c=Object.entries(o||{}).filter(function(P){var O=p()(P,1),Z=O[0];return!isNaN(Number(Z))}).map(function(P){var O=p()(P,2),Z=O[1];return Z}).flat().filter(Boolean);return console.log("Returning scales:",c),c},k=function(o){var f={};return f.chords=o.filter(function(i){return a.sw.includes(i)}),a.Dz.forEach(function(i){f[i]=o.filter(function(c){return c.endsWith(String(i))&&!a.sw.includes(c)})}),f};(0,v.useEffect)(function(){var N=(0,ie.Tp)(a.F6,null);if(N)try{var o=N;o.toneList&&!o.toneListGroup&&(o.toneListGroup=k(o.toneList));var f=o.loopCountType||String(o.loopCount||0),i=o.loopCountCustom||o.loopCount||10;F.setFieldsValue(d()(d()({},o),{},{loopCountType:f,loopCountCustom:f==="custom"?i:10})),o.instrumentName&&(0,_.pr)(o.instrumentName).catch(console.error),m(d()(d()(d()({},a.sO),o),{},{loopCount:f==="custom"?i:parseInt(f,10),toneList:Y(o.toneListGroup,o.toneType||a.W4)}))}catch(c){console.error("Failed to load settings",c)}},[F]);var J=function(o,f){(0,ie.pd)(a.F6,f,C.formatMessage({id:"tone-training.storage-name"}))},B=function(o){var f=Y(o.toneListGroup,o.toneType),i=o.loopCountType==="custom"?o.loopCountCustom:parseInt(o.loopCountType,10),c=d()(d()(d()({},a.sO),o),{},{toneList:f,loopCount:isNaN(i)?0:i});m(c),M(!0)};return(0,t.jsxs)(Re._z,{header:{title:C.formatMessage({id:"menu.instrument.tone-training"})},children:[(0,t.jsxs)(j.A,{form:F,size:"large",initialValues:d()(d()({},a.sO),{},{loopCountType:String(a.sO.loopCount),loopCountCustom:10,toneListGroup:k(a.sO.toneList)}),onValuesChange:J,onFinish:B,layout:"horizontal",submitter:{searchConfig:{resetText:C.formatMessage({id:"common.reset"}),submitText:C.formatMessage({id:"tone-training.start-training"})},render:function(o,f){return(0,t.jsx)(Ae.S,{children:f})}},children:[(0,t.jsx)(ve.Z,{}),(0,t.jsx)(pe,{}),(0,t.jsx)(Se,{})]}),(0,t.jsx)(We,d()({open:T,onCancel:function(){return M(!1)}},b))]})},De=Fe}}]);
