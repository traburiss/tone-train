"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[471],{66905:function(z,P,t){t.r(P),t.d(P,{default:function(){return X}});var B=t(90228),A=t.n(B),I=t(87999),Z=t.n(I),v=t(48305),N=t.n(v),R=t(8481),y=t(75271),e=t(52676),b=function(c){var f=c.value,d=c.onChange,S=c.height,h=S===void 0?"300px":S,O=c.language,D=O===void 0?"json":O,E=c.readonly,x=E===void 0?!1:E,l=function(m){d&&d(m)};return(0,e.jsx)("div",{style:{border:"1px solid #d9d9d9",borderRadius:"4px",overflow:"auto",resize:"vertical",height:h},children:(0,e.jsx)(R.ZP,{height:"100%",language:D,value:f,onChange:l,options:{minimap:{enabled:!1},fontSize:13,scrollBeyondLastLine:!1,automaticLayout:!0,readOnly:x,tabSize:2,formatOnPaste:!0,formatOnType:!0}})})},F=b,n=t(67056),s=t(69334),a=t(18022),o=t(30244),r=t(2866),g=t(30945),C=t(17940),J=t(82796),L=t(66931),j=t(20025),T=t(95216),G=t(79662),W=t(78081),$=t(76842),V=function(c){var f=c.storageKey,d=c.name,S=c.initialValue,h=c.onSaved,O=g.A.useForm(),D=N()(O,1),E=D[0];(0,y.useEffect)(function(){E.setFieldsValue({json:JSON.stringify(S,null,2)})},[S]);var x=function(){var l=Z()(A()().mark(function i(m){return A()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:L.Z.confirm({title:"\u786E\u8BA4\u4FDD\u5B58\u914D\u7F6E\u5417\uFF1F",content:"\u786E\u8BA4\u4FDD\u5B58 ".concat(d," (key: ").concat(f,") \u7684\u914D\u7F6E\u5417\uFF1F"),okText:"\u786E\u8BA4",okType:"primary",onOk:function(){try{var K=JSON.parse(m.json);(0,n.pd)(f,K,d),j.ZP.success("".concat(d," \u4FDD\u5B58\u6210\u529F")),h()}catch(H){j.ZP.error("\u4FDD\u5B58\u5931\u8D25\uFF1AJSON \u8BED\u6CD5\u9519\u8BEF")}}});case 1:case"end":return u.stop()}},i)}));return function(m){return l.apply(this,arguments)}}();return(0,e.jsx)(C.Z,{title:(0,e.jsx)("span",{className:"font-bold text-primary",children:d}),subTitle:(0,e.jsxs)("code",{className:"text-xs text-secondary opacity-60 ml-2",children:["Key: ",f]}),className:"mb-4 shadow-sm",collapsible:!0,defaultCollapsed:!0,children:(0,e.jsx)(g.A,{form:E,onFinish:x,submitter:{render:function(i){return(0,e.jsx)(T.ZP,{type:"primary",icon:(0,e.jsx)(s.Z,{}),onClick:function(){return i.submit()},children:"\u4FDD\u5B58\u672C\u9879\u4FEE\u6539"})}},children:(0,e.jsx)(g.A.Item,{name:"json",label:"\u914D\u7F6E\u503C",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u914D\u7F6E\u5185\u5BB9"}],children:(0,e.jsx)(F,{height:"300px"})})})})},Q=function(){var c=(0,y.useState)({}),f=N()(c,2),d=f[0],S=f[1],h=function(){S((0,n.GR)())};(0,y.useEffect)(function(){h()},[]);var O=function(){var i=(0,n.GR)(),m=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),p=URL.createObjectURL(m),u=document.createElement("a");u.href=p,u.download="mta-settings-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(p),j.ZP.success("\u5BFC\u51FA\u5168\u91CF\u914D\u7F6E\u6210\u529F")},D=function(i){var m=new FileReader;return m.onload=function(p){try{var u,M=JSON.parse((u=p.target)===null||u===void 0?void 0:u.result);(0,n.QM)(M),j.ZP.success("\u5BFC\u5165\u914D\u7F6E\u6210\u529F"),h()}catch(K){j.ZP.error("\u5BFC\u5165\u5931\u8D25\uFF1AJSON \u683C\u5F0F\u4E0D\u6B63\u786E")}},m.readAsText(i),!1},E=function(){L.Z.confirm({title:"\u786E\u8BA4\u91CD\u7F6E\u6240\u6709\u914D\u7F6E\uFF1F",content:"\u8BE5\u64CD\u4F5C\u5C06\u5220\u9664\u6240\u6709\uFF08\u5E26\u6709 mta:cfg \u524D\u7F00\u7684\uFF09\u672C\u5730\u4FDD\u5B58\u8BBE\u7F6E\u3002",okText:"\u786E\u8BA4\u91CD\u7F6E",okType:"danger",onOk:function(){(0,n.qt)(),j.ZP.success("\u6240\u6709\u8BBE\u7F6E\u5DF2\u91CD\u7F6E"),h()}})},x=Object.keys(d).sort(function(l,i){var m=d[l].name||"",p=d[i].name||"";return m.localeCompare(p,"zh-CN")});return(0,e.jsxs)(J._z,{title:"\u7CFB\u7EDF\u8BBE\u7F6E",children:[(0,e.jsx)(C.Z,{title:"\u5168\u5C40\u6570\u636E\u64CD\u4F5C",className:"mb-6",children:(0,e.jsxs)(G.Z,{size:"middle",wrap:!0,children:[(0,e.jsx)(T.ZP,{icon:(0,e.jsx)(a.Z,{}),onClick:O,children:"\u5BFC\u51FA\u5168\u91CF (JSON)"}),(0,e.jsx)(W.Z,{beforeUpload:D,showUploadList:!1,accept:".json",children:(0,e.jsx)(T.ZP,{icon:(0,e.jsx)(o.Z,{}),children:"\u5BFC\u5165\u5168\u91CF (JSON)"})}),(0,e.jsx)(T.ZP,{icon:(0,e.jsx)(r.Z,{}),danger:!0,onClick:E,children:"\u91CD\u7F6E\u5168\u90E8\u914D\u7F6E"})]})}),"\u3001",(0,e.jsx)(C.Z,{title:"\u914D\u7F6E\u9879",className:"mb-6",children:x.length===0?(0,e.jsx)($.Z,{description:"\u6682\u65E0\u5DF2\u4FDD\u5B58\u7684\u5206\u9879\u914D\u7F6E"}):x.map(function(l){var i=d[l];return(0,e.jsx)(V,{storageKey:l,name:i.name,initialValue:i.value,onSaved:h},l)})})]})},X=Q},67056:function(z,P,t){t.d(P,{GR:function(){return y},QM:function(){return e},Tp:function(){return N},pd:function(){return R},qt:function(){return b}});var B=t(48305),A=t.n(B),I=t(31759),Z=t.n(I),v="mta:cfg",N=function(n,s){var a=localStorage.getItem("".concat(v).concat(n));if(!a&&n==="tones:training"){var o=localStorage.getItem("music-teaching-assistant-settings");if(o)return localStorage.setItem("".concat(v).concat(n),o),JSON.parse(o)}if(!a)return s;try{var r=JSON.parse(a);return r&&Z()(r)==="object"&&"name"in r&&"value"in r?r.value:r}catch(g){return console.error("Failed to parse settings for ".concat(n),g),s}},R=function(n,s,a){var o=localStorage.getItem("".concat(v).concat(n)),r=a;if(!r&&o)try{var g=JSON.parse(o);g!=null&&g.name&&(r=g.name)}catch(J){}var C={name:r||n,value:s,updatedAt:Date.now()};localStorage.setItem("".concat(v).concat(n),JSON.stringify(C))},y=function(){for(var n={},s=0;s<localStorage.length;s++){var a=localStorage.key(s);if(a!=null&&a.startsWith(v)){var o=localStorage.getItem(a);if(o)try{n[a.replace(v,"")]=JSON.parse(o)}catch(r){console.error("Failed to parse all settings for key ".concat(a),r)}}}return n},e=function(n){Object.entries(n).forEach(function(s){var a=A()(s,2),o=a[0],r=a[1];r&&Z()(r)==="object"&&"name"in r&&"value"in r?localStorage.setItem("".concat(v).concat(o),JSON.stringify(r)):R(o,r,o)})},b=function(){for(var n=[],s=0;s<localStorage.length;s++){var a=localStorage.key(s);a!=null&&a.startsWith(v)&&n.push(a)}n.forEach(function(o){return localStorage.removeItem(o)})}}}]);
