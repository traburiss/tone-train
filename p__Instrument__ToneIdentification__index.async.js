"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[132],{97166:function(Mt,fe,a){a.r(fe),a.d(fe,{default:function(){return lt}});var Fe=a(48305),f=a.n(Fe),Le=a(5318),K=a(82238),i=a(75271),De=a(26068),_=a.n(De),Oe=a(90228),X=a.n(Oe),ze=a(87999),ne=a.n(ze),we=a(99788),G=a(67849),J=a(6946),me=a(21017),re=a(40624),We=a(21004),ie=a(24486),ve=a(84611),$e=a(97375),Ee=a(1501),ee=a(30933),k=a(45803),He=a(15558),se=a.n(He),Ve=a(7033),Ye=a(32613),oe=a(85747),Qe=a(82773),ge=a(1073),Xe=a(45190),he=a(70439),xe=a(55248),ye=function(){return(0,J.fy)(G.Ry,[])},Be=function(S){var l=ye();l.push(S),l.length>100&&l.shift(),(0,J._Y)(G.Ry,l,"\u542C\u97F3\u5224\u65AD\u7EDF\u8BA1\u6570\u636E")},Ue=function(){(0,J._Y)(G.Ry,[],"\u542C\u97F3\u5224\u65AD\u7EDF\u8BA1\u6570\u636E")},e=a(52676),B=null,Ke=function(S){var l=S.open,s=S.settings,b=S.onCancel,C=(0,i.useState)(null),A=f()(C,2),M=A[0],z=A[1],Z=(0,i.useState)([]),F=f()(Z,2),P=F[0],c=F[1],r=(0,i.useState)([]),L=f()(r,2),v=L[0],N=L[1],y=(0,i.useState)(s.timeLimit),j=f()(y,2),t=j[0],o=j[1],w=(0,i.useState)(0),Y=f()(w,2),D=Y[1],te=(0,i.useState)(0),T=f()(te,2),O=T[0],$=T[1],h=(0,i.useState)(0),g=f()(h,2),I=g[0],E=g[1],H=(0,i.useState)(0),U=f()(H,2),ct=U[0],ce=U[1],ut=(0,i.useState)(!1),je=f()(ut,2),dt=je[0],Me=je[1],ft=(0,i.useState)(!0),be=f()(ft,2),Ce=be[0],Te=be[1],mt=(0,i.useState)(!1),Ne=f()(mt,2),ue=Ne[0],Ie=Ne[1],p=(0,K.useIntl)(),Re=(0,i.useRef)(0),Ze=(0,i.useRef)(0),q=(0,i.useRef)(null),de=(0,i.useRef)(0),Q=(0,i.useRef)([]),ae=(0,i.useMemo)(function(){var d=s.toneListGroup,u=s.toneType;return u==="GuitarChords"?d.chords||[]:Object.entries(d).filter(function(m){var x=f()(m,1),n=x[0];return!isNaN(Number(n))}).map(function(m){var x=f()(m,2),n=x[1];return n}).flat().filter(Boolean)},[s]),Pe=function(){var d=ne()(X()().mark(function u(m){var x,n;return X()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(B){R.next=2;break}return R.abrupt("return");case 2:Me(!0),x=(s.toneDuration||1e3)/1e3,s.toneType==="GuitarChords"?(n=(0,oe.UV)(m),n.length>0?B.triggerAttackRelease(n,x):B.triggerAttackRelease(m,x)):B.triggerAttackRelease(m,x),setTimeout(function(){return Me(!1)},x*1e3);case 6:case"end":return R.stop()}},u)}));return function(m){return d.apply(this,arguments)}}(),Ge=function(){if(ae.length===0){ee.ZP.error(p.formatMessage({id:"game.error.no-tones"})),b();return}var u=ae[Math.floor(Math.random()*ae.length)];z(u),N([]),Ie(!1);var m=[u],x=ae.filter(function(R){return R!==u}),n=s.difficulty-1,W=x.sort(function(){return .5-Math.random()});m.push.apply(m,se()(W.slice(0,n))),c(m.sort(function(){return .5-Math.random()})),Pe(u),Ze.current=Date.now()},vt=function(){var d=ne()(X()().mark(function u(){var m;return X()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return Te(!0),n.prev=1,n.next=4,(0,me.pr)(s.instrumentName);case 4:m=n.sent,B=m,n.next=12;break;case 8:n.prev=8,n.t0=n.catch(1),console.error("Failed to load instrument, falling back to PolySynth",n.t0),B=new xe.v2(xe.WV).toDestination();case 12:Te(!1),Ge();case 14:case"end":return n.stop()}},u,null,[[1,8]])}));return function(){return d.apply(this,arguments)}}(),gt=function(u){if(u===M){var m=(Date.now()-Ze.current)/1e3;Q.current.push({timeTaken:m,correct:v.length===0}),D(function(n){return n+1}),E(function(n){return n+1}),$(function(n){return de.current=n+1,n+1});var x=v.length===0;ce(x?function(n){var W=n+1;return W%3===0&&s.mode==="timed"&&(o(function(R){return R+5}),ee.ZP.success(p.formatMessage({id:"game.success.combo"},{count:W,bonus:5}))),W}:0),Ie(!0),setTimeout(Ge,s.toneWait||1e3)}else v.includes(u)||(N(function(n){return[].concat(se()(n),[u])}),$(function(n){return de.current=n+1,n+1}),ce(0))},Ae=function(){if(Q.current.length===0)return null;var u=(Date.now()-Re.current)/1e3,m=Q.current.length,x=de.current,n=x>0?m/x:0,W=Q.current.reduce(function(St,jt){return St+jt.timeTaken},0)/Q.current.length,R={timestamp:Date.now(),difficulty:s.difficulty,mode:s.mode,correctCount:m,totalQuestions:Q.current.length,accuracy:n,avgResponseTime:W,duration:u};return Be(R),R},ht=function(){var u=Ae();if(!u){b();return}ge.Z.info({title:p.formatMessage({id:"game.over.title"}),content:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:p.formatMessage({id:"game.over.correct-count"},{count:u.correctCount})}),(0,e.jsx)("p",{children:p.formatMessage({id:"game.over.accuracy"},{accuracy:(u.accuracy*100).toFixed(1)})}),(0,e.jsx)("p",{children:p.formatMessage({id:"game.over.avg-time"},{time:u.avgResponseTime.toFixed(2)})})]}),onOk:b})},xt=function(){Q.current.length>0&&(Ae(),ee.ZP.info(p.formatMessage({id:"game.cancel.info"}))),b()};(0,i.useEffect)(function(){return l&&(vt(),Re.current=Date.now(),s.mode==="timed"&&(o(s.timeLimit),q.current=setInterval(function(){o(function(d){return d<=1?(q.current&&clearInterval(q.current),ht(),0):d-1})},1e3))),function(){q.current&&clearInterval(q.current)}},[l]);var yt=(0,Ye.u)(s.instrumentName),pt=yt.status;return(0,e.jsx)(ge.Z,{open:l,onCancel:xt,footer:null,destroyOnHidden:!0,width:"90%",style:{maxWidth:800},centered:!0,maskClosable:!1,title:(0,e.jsxs)("div",{className:"flex justify-between items-center pr-8",children:[(0,e.jsxs)("span",{children:[p.formatMessage({id:"game.title.prefix"}),s.mode==="timed"?p.formatMessage({id:"tone-identification.mode.timed"}):p.formatMessage({id:"tone-identification.mode.infinite"})]}),s.mode==="timed"&&(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("span",{className:t<10?"text-red-500 font-bold":"",children:p.formatMessage({id:"game.time-left"},{time:t})}),(0,e.jsx)(Xe.Z,{type:"circle",percent:t/s.timeLimit*100,size:{width:30},showInfo:!1,strokeColor:t<10?"#ff4d4f":"#1890ff"})]})]}),children:(0,e.jsxs)("div",{className:"py-4 text-center",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)(he.ZP,{type:"primary",shape:"round",icon:(0,e.jsx)(Qe.Z,{}),size:"large",onClick:function(){return M&&Pe(M)},loading:dt||Ce,children:p.formatMessage({id:"game.replay-sound"})}),(0,e.jsx)("div",{className:"mt-2 text-gray-400 text-xs",children:Ce?p.formatMessage({id:"game.preparing-instrument"}):pt==="loaded"?p.formatMessage({id:"game.instrument-ready"}):p.formatMessage({id:"game.instrument-loading-midi"})})]}),(0,e.jsx)("div",{className:"grid gap-2 mb-6",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:P.map(function(d){var u=ue&&d===M,m=v.includes(d),x=ue&&d!==M,n=s.toneType==="GuitarChords";return(0,e.jsxs)("div",{className:`
                  flex flex-col items-center justify-center p-0.5 border rounded transition-all select-none overflow-hidden
                  `.concat(u?"bg-green-50 border-green-500 shadow-md scale-105 z-10":m?"bg-red-50 border-red-200 opacity-60 cursor-not-allowed":x?"bg-gray-50 border-gray-100 opacity-30 cursor-not-allowed":"bg-white border-blue-50 shadow-sm hover:border-blue-300 active:scale-95 cursor-pointer",`
                `),onClick:function(){return!m&&!ue&&gt(d)},children:[(0,e.jsx)("div",{className:"font-bold truncate w-full text-center leading-tight ".concat(u?"text-green-600 text-sm":m?"text-red-500":n?"text-[10px] text-gray-400":"text-sm text-gray-700"),children:d}),oe.YD[d]&&(0,e.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,e.jsx)(Ve.Z,{name:d,fingering:oe.YD[d],width:60,height:80,showName:!1})})]},d)})}),(0,e.jsxs)("div",{className:"flex justify-between text-gray-500 border-t pt-4",children:[(0,e.jsx)("span",{children:p.formatMessage({id:"game.correct-count-title"},{count:I})}),(0,e.jsx)("span",{children:p.formatMessage({id:"game.combo-bonus"},{count:ct})}),(0,e.jsx)("span",{children:p.formatMessage({id:"game.accuracy-title"},{accuracy:O>0?(I/O*100).toFixed(0):0})})]})]})})},Je=Ke,ke={toneType:G.W4,instrumentName:G.OG,toneListGroup:{chords:["C","D","G","Em","Am"]},difficulty:2,mode:"timed",timeLimit:60,toneDuration:1e3,toneWait:1500},qe=function(){var S=re.A.useForm(),l=f()(S,1),s=l[0],b=(0,i.useState)(!1),C=f()(b,2),A=C[0],M=C[1],z=(0,i.useState)(null),Z=f()(z,2),F=Z[0],P=Z[1],c=(0,K.useIntl)(),r=(0,G.L3)(c),L=re.A.useWatch("instrumentName",s)||G.OG;(0,i.useEffect)(function(){(0,me.pr)(L).catch(console.error)},[L]),(0,i.useEffect)(function(){var y=(0,J.Tp)(G.Ry,null);y&&s.setFieldsValue(y)},[s]);var v=function(j,t){(0,J.pd)(G.Ry,t,c.formatMessage({id:"tone-identification.storage-name"}))},N=function(){var y=ne()(X()().mark(function j(t){var o,w,Y,D;return X()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(o=t.toneListGroup,w=t.toneType,Y=t.difficulty,D=[],w==="GuitarChords"?D=o.chords||[]:D=Object.entries(o).filter(function(O){var $=f()(O,1),h=$[0];return!isNaN(Number(h))}).map(function(O){var $=f()(O,2),h=$[1];return h}).flat().filter(Boolean),!(D.length<Y)){T.next=6;break}return ee.ZP.error(c.formatMessage({id:"tone-identification.difficulty-error"},{count:D.length,difficulty:Y})),T.abrupt("return");case 6:P(t),M(!0);case 8:case"end":return T.stop()}},j)}));return function(t){return y.apply(this,arguments)}}();return(0,e.jsxs)("div",{children:[(0,e.jsxs)(re.A,{form:s,initialValues:ke,onValuesChange:v,onFinish:N,submitter:{searchConfig:{submitText:c.formatMessage({id:"tone-identification.start-test"})},render:function(j,t){return(0,e.jsx)(We.S,{children:t})}},children:[(0,e.jsx)(we.Z,{}),(0,e.jsx)(k.Z,{title:c.formatMessage({id:"tone-identification.test-settings"}),className:"mb-6",children:(0,e.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-4 border-b pb-4",children:[(0,e.jsx)(ie.Z.Group,{name:"instrumentName",label:c.formatMessage({id:"tone-identification.instrument"}),radioType:"button",fieldProps:{buttonStyle:"solid",size:"middle"},options:G.qL.map(function(y){return _()(_()({},y),{},{label:c.formatMessage({id:y.label})})})}),(0,e.jsx)(ie.Z.Group,{name:"difficulty",label:c.formatMessage({id:"tone-identification.difficulty"}),radioType:"button",fieldProps:{buttonStyle:"solid",size:"middle"},options:[{label:c.formatMessage({id:"tone-identification.difficulty.easy"}),value:2},{label:c.formatMessage({id:"tone-identification.difficulty.medium"}),value:4},{label:c.formatMessage({id:"tone-identification.difficulty.hard"}),value:6},{label:c.formatMessage({id:"tone-identification.difficulty.hell"}),value:8}]})]}),(0,e.jsxs)("div",{className:"flex flex-wrap gap-x-8 gap-y-0 border-b pb-4",children:[(0,e.jsx)(ve.Z,{name:"toneDuration",label:c.formatMessage({id:"tone-identification.tone-duration"}),min:100,max:5e3,step:100,width:"md",fieldProps:{tooltip:{formatter:r}}}),(0,e.jsx)(ve.Z,{name:"toneWait",label:c.formatMessage({id:"tone-identification.tone-wait"}),min:100,max:5e3,step:100,width:"md",fieldProps:{tooltip:{formatter:r}}})]}),(0,e.jsxs)("div",{className:"flex flex-wrap items-center gap-8",children:[(0,e.jsx)(ie.Z.Group,{name:"mode",label:c.formatMessage({id:"tone-identification.mode"}),radioType:"button",fieldProps:{buttonStyle:"solid",size:"middle"},options:[{label:c.formatMessage({id:"tone-identification.mode.infinite"}),value:"infinite"},{label:c.formatMessage({id:"tone-identification.mode.timed"}),value:"timed"}]}),(0,e.jsx)($e.Z,{name:["mode"],children:function(j){var t=j.mode;return t==="timed"&&(0,e.jsx)(Ee.Z,{name:"timeLimit",label:c.formatMessage({id:"tone-identification.time-limit"}),width:"xs",min:10,fieldProps:{step:10}})}})]})]})})]}),F&&(0,e.jsx)(Je,{open:A,settings:F,onCancel:function(){return M(!1)}})]})},_e=qe,et=a(335),tt=a.n(et),at=a(43969),nt=a(52402),le=a(64451),pe=a(20293),rt=a(88645),Se=function(S){var l=S.data,s=S.label,b=S.color,C=b===void 0?"":b,A=S.suffix,M=A===void 0?"":A,z=(0,K.useIntl)(),Z=i.useRef(null),F=i.useState(0),P=f()(F,2),c=P[0],r=P[1],L=i.useState(null),v=f()(L,2),N=v[0],y=v[1];if(i.useEffect(function(){if(Z.current){var h=new ResizeObserver(function(g){var I=tt()(g),E;try{for(I.s();!(E=I.n()).done;){var H=E.value;r(H.contentRect.width)}}catch(U){I.e(U)}finally{I.f()}});return h.observe(Z.current),function(){return h.disconnect()}}},[]),l.length===0)return(0,e.jsx)(at.Z,{description:z.formatMessage({id:"common.no-data"})});var j=200,t=20,o=c-t*2,w=j-t*2;if(c===0)return(0,e.jsx)("div",{ref:Z,style:{height:j},className:"w-full"});var Y=Math.max.apply(Math,se()(l).concat([1])),D=0,te=Y-D,T=function(g){return t+g/(l.length-1||1)*o},O=function(g){return t+w-(g-D)/te*w},$=l.map(function(h,g){return"".concat(T(g),",").concat(O(h))}).join(" ");return(0,e.jsxs)("div",{className:"w-full relative",ref:Z,children:[(0,e.jsx)("div",{className:"font-semibold mb-2",children:s}),(0,e.jsxs)("svg",{width:c,height:j,className:"bg-gray-50 rounded",children:[[0,.25,.5,.75,1].map(function(h){return(0,e.jsx)("line",{x1:t,y1:t+w*h,x2:c-t,y2:t+w*h,stroke:"#e5e7eb",strokeDasharray:"4"},h)}),(0,e.jsx)("polyline",{fill:"none",stroke:C,strokeWidth:"3",strokeLinejoin:"round",points:$}),l.map(function(h,g){return(0,e.jsx)("circle",{cx:T(g),cy:O(h),r:N===g?6:4,fill:C,style:{transition:"r 0.2s"}},g)}),l.map(function(h,g){var I=o/(l.length-1||1),E=T(g)-I/2,H=I;return g===0?(E=0,H=t+I/2):g===l.length-1&&(H=t+I/2),l.length===1&&(E=0,H=c),(0,e.jsx)("rect",{x:E,y:0,width:H,height:j,fill:"transparent",onMouseEnter:function(){return y(g)},onMouseLeave:function(){return y(null)},style:{cursor:"crosshair"}},"overlay-".concat(g))})]}),N!==null&&(0,e.jsxs)("div",{className:"absolute bg-black/75 text-white text-xs px-2 py-1 rounded pointer-events-none z-10 transform -translate-x-1/2 -translate-y-full",style:{left:T(N),top:O(l[N])-8},children:[l[N].toFixed(2),M]}),(0,e.jsxs)("div",{className:"flex justify-between text-xs text-gray-400 mt-1 px-5",children:[(0,e.jsx)("span",{children:z.formatMessage({id:"common.earlier"})}),(0,e.jsx)("span",{children:z.formatMessage({id:"common.recent"})})]})]})},it=function(){var S=(0,i.useState)(20),l=f()(S,2),s=l[0],b=l[1],C=(0,i.useState)("all"),A=f()(C,2),M=A[0],z=A[1],Z=(0,i.useState)("all"),F=f()(Z,2),P=F[0],c=F[1],r=(0,K.useIntl)(),L=(0,i.useMemo)(function(){return ye()},[]),v=(0,i.useMemo)(function(){var t=L;return M!=="all"&&(t=t.filter(function(o){return o.difficulty===M})),P!=="all"&&(t=t.filter(function(o){return o.mode===P})),t.slice(-s)},[L,s,M,P]),N=(0,i.useMemo)(function(){return v.length===0?0:v.reduce(function(t,o){return t+o.accuracy},0)/v.length},[v]),y=(0,i.useMemo)(function(){return v.length===0?0:v.reduce(function(t,o){return t+o.avgResponseTime},0)/v.length},[v]),j=function(){Ue(),window.location.reload()};return(0,e.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,e.jsx)(k.Z,{title:r.formatMessage({id:"stats.config"}),size:"small",children:(0,e.jsxs)(nt.Z,{wrap:!0,size:16,children:[(0,e.jsxs)("div",{children:[(0,e.jsxs)("span",{className:"mr-2",children:[r.formatMessage({id:"stats.history-length"}),":"]}),(0,e.jsx)(le.Z,{value:s,onChange:b,style:{width:140},options:[10,20,50,100].map(function(t){return{label:r.formatMessage({id:"stats.history-length.n"},{n:t}),value:t}})})]}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("span",{className:"mr-2",children:[r.formatMessage({id:"stats.difficulty-filter"}),":"]}),(0,e.jsx)(le.Z,{value:M,onChange:z,style:{width:140},options:[{label:r.formatMessage({id:"stats.difficulty-all"}),value:"all"},{label:r.formatMessage({id:"option.difficulty.n-choice-1"},{n:2}),value:2},{label:r.formatMessage({id:"option.difficulty.n-choice-1"},{n:4}),value:4},{label:r.formatMessage({id:"option.difficulty.n-choice-1"},{n:6}),value:6},{label:r.formatMessage({id:"option.difficulty.n-choice-1"},{n:8}),value:8}]})]}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("span",{className:"mr-2",children:[r.formatMessage({id:"stats.mode-filter"}),":"]}),(0,e.jsx)(le.Z,{value:P,onChange:c,style:{width:140},options:[{label:r.formatMessage({id:"stats.mode-all"}),value:"all"},{label:r.formatMessage({id:"tone-identification.mode.timed"}),value:"timed"},{label:r.formatMessage({id:"tone-identification.mode.infinite"}),value:"infinite"}]})]}),(0,e.jsx)(he.ZP,{danger:!0,size:"small",onClick:j,children:r.formatMessage({id:"stats.reset-data"})})]})}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)(k.Z,{size:"small",children:[(0,e.jsx)(pe.Z,{title:r.formatMessage({id:"stats.avg-accuracy"}),value:N*100,precision:1,suffix:"%",valueStyle:{color:"#3f8600"}}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(Se,{data:v.map(function(t){return t.accuracy*100}),label:r.formatMessage({id:"stats.accuracy-trend"}),color:"#3f8600"})})]}),(0,e.jsxs)(k.Z,{size:"small",children:[(0,e.jsx)(pe.Z,{title:r.formatMessage({id:"stats.avg-response-time"}),value:y,precision:2,suffix:"s",valueStyle:{color:"#1890ff"}}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(Se,{data:v.map(function(t){return t.avgResponseTime}),label:r.formatMessage({id:"stats.response-time-trend"}),color:"#1890ff"})})]})]}),(0,e.jsx)(k.Z,{title:r.formatMessage({id:"stats.detailed-history"}),size:"small",children:(0,e.jsx)(rt.Z,{dataSource:v.map(function(t,o){return _()(_()({},t),{},{key:o})}),columns:[{title:r.formatMessage({id:"table.column.time"}),dataIndex:"timestamp",render:function(o){return new Date(o).toLocaleString()},responsive:["md"]},{title:r.formatMessage({id:"table.column.difficulty"}),dataIndex:"difficulty",render:function(o){return r.formatMessage({id:"option.difficulty.n-choice-1"},{n:o})}},{title:r.formatMessage({id:"table.column.mode"}),dataIndex:"mode",render:function(o){return o==="timed"?r.formatMessage({id:"option.mode.timed.short"}):r.formatMessage({id:"option.mode.infinite.short"})}},{title:r.formatMessage({id:"table.column.score"}),dataIndex:"correctCount"},{title:r.formatMessage({id:"table.column.accuracy"}),dataIndex:"accuracy",render:function(o){return"".concat((o*100).toFixed(0),"%")}},{title:r.formatMessage({id:"table.column.duration"}),dataIndex:"avgResponseTime",render:function(o){return"".concat(o.toFixed(2),"s")}}],pagination:{pageSize:5},size:"small"})})]})},st=it,ot=function(){var S=(0,i.useState)("practice"),l=f()(S,2),s=l[0],b=l[1],C=(0,K.useIntl)();return(0,e.jsxs)(Le._z,{header:{title:C.formatMessage({id:"menu.instrument.tone-identification"})},tabList:[{tab:C.formatMessage({id:"tone-identification.practice"}),key:"practice"},{tab:C.formatMessage({id:"tone-identification.statistics"}),key:"statistics"}],tabActiveKey:s,onTabChange:b,children:[s==="practice"&&(0,e.jsx)(_e,{}),s==="statistics"&&(0,e.jsx)(st,{})]})},lt=ot}}]);
