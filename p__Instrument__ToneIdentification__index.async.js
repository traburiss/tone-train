"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[132],{11215:function(dt,ee,t){t.r(ee),t.d(ee,{default:function(){return ke}});var Fe=t(48305),d=t.n(Fe),Ee=t(5318),s=t(75271),Te=t(90228),L=t.n(Te),De=t(87999),U=t.n(De),Ne=t(93043),D=t(89504),V=t(67056),te=t(39420),K=t(40624),be=t(21004),Ie=t(31770),ne=t(24486),Ze=t(97375),Ae=t(1501),Y=t(30933),W=t(45803),Be=t(15558),J=t.n(Be),Re=t(26007),Pe=t(92439),X=t(32401),Ge=t(99430),ae=t(1073),Le=t(45190),k=t(70439),re=t(55248),se=function(){return(0,V.fy)(D.Ry,[])},Me=function(p){var l=se();l.push(p),l.length>100&&l.shift(),(0,V._Y)(D.Ry,l,"\u542C\u97F3\u5224\u65AD\u7EDF\u8BA1\u6570\u636E")},Oe=function(){(0,V._Y)(D.Ry,[],"\u542C\u97F3\u5224\u65AD\u7EDF\u8BA1\u6570\u636E")},e=t(52676),M=null,ze=function(p){var l=p.open,r=p.settings,S=p.onCancel,N=(0,s.useState)(null),C=d()(N,2),j=C[0],x=C[1],b=(0,s.useState)([]),y=d()(b,2),E=y[0],T=y[1],I=(0,s.useState)([]),m=d()(I,2),o=m[0],g=m[1],v=(0,s.useState)(r.timeLimit),a=d()(v,2),u=a[0],B=a[1],R=(0,s.useState)(0),oe=d()(R,2),P=oe[1],$=(0,s.useState)(0),O=d()($,2),Z=O[0],ce=O[1],qe=(0,s.useState)(0),de=d()(qe,2),H=de[0],_e=de[1],et=(0,s.useState)(0),fe=d()(et,2),tt=fe[0],_=fe[1],nt=(0,s.useState)(!1),ve=d()(nt,2),at=ve[0],me=ve[1],rt=(0,s.useState)(!0),he=d()(rt,2),xe=he[0],ge=he[1],pe=(0,s.useRef)(0),ye=(0,s.useRef)(0),w=(0,s.useRef)(null),z=(0,s.useRef)([]),Q=(0,s.useMemo)(function(){var c=r.toneListGroup,i=r.toneType;return i==="GuitarChords"?c.chords||[]:Object.entries(c).filter(function(f){var h=d()(f,1),n=h[0];return!isNaN(Number(n))}).map(function(f){var h=d()(f,2),n=h[1];return n}).flat().filter(Boolean)},[r]),je=function(){var c=U()(L()().mark(function i(f){var h,n;return L()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(M){F.next=2;break}return F.abrupt("return");case 2:me(!0),h=1.5,r.toneType==="GuitarChords"?(n=(0,X.UV)(f),n.length>0?M.triggerAttackRelease(n,h):M.triggerAttackRelease(f,h)):M.triggerAttackRelease(f,h),setTimeout(function(){return me(!1)},h*1e3);case 6:case"end":return F.stop()}},i)}));return function(f){return c.apply(this,arguments)}}(),Se=function(){if(Q.length===0){Y.ZP.error("\u672A\u9009\u62E9\u4EFB\u4F55\u97F3\u9636\u6216\u548C\u5F26"),S();return}var i=Q[Math.floor(Math.random()*Q.length)];x(i),g([]);var f=[i],h=Q.filter(function(F){return F!==i}),n=r.difficulty-1,G=h.sort(function(){return .5-Math.random()});f.push.apply(f,J()(G.slice(0,n))),T(f.sort(function(){return .5-Math.random()})),je(i),ye.current=Date.now()},st=function(){var c=U()(L()().mark(function i(){var f;return L()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return ge(!0),n.prev=1,n.next=4,(0,te.pr)(r.instrumentName);case 4:f=n.sent,M=f,n.next=12;break;case 8:n.prev=8,n.t0=n.catch(1),console.error("Failed to load instrument, falling back to PolySynth",n.t0),M=new re.v2(re.WV).toDestination();case 12:ge(!1),Se();case 14:case"end":return n.stop()}},i,null,[[1,8]])}));return function(){return c.apply(this,arguments)}}(),ut=function(i){if(i===j){var f=(Date.now()-ye.current)/1e3;z.current.push({timeTaken:f,correct:o.length===0}),P(function(n){return n+1}),_e(function(n){return n+1}),ce(function(n){return n+1});var h=o.length===0;_(h?function(n){var G=n+1;return G%3===0&&r.mode==="timed"&&(B(function(F){return F+5}),Y.ZP.success("\u8FDE\u5BF93\u6B21\uFF0C\u65F6\u95F4+5s\uFF01")),G}:0),Se()}else o.includes(i)||(g(function(n){return[].concat(J()(n),[i])}),ce(function(n){return n+1}),_(0))},Ce=function(){if(z.current.length===0)return null;var i=(Date.now()-pe.current)/1e3,f=Z>0?H/Z:0,h=z.current.reduce(function(G,F){return G+F.timeTaken},0)/z.current.length,n={timestamp:Date.now(),difficulty:r.difficulty,mode:r.mode,correctCount:H,totalQuestions:z.current.length,accuracy:f,avgResponseTime:h,duration:i};return Me(n),{accuracy:f,avgResponseTime:h}},it=function(){var i=Ce();if(!i){S();return}ae.Z.info({title:"\u6D4B\u8BD5\u7ED3\u675F",content:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{children:["\u6B63\u786E\u6570\u91CF: ",H]}),(0,e.jsxs)("p",{children:["\u51C6\u786E\u7387: ",(i.accuracy*100).toFixed(1),"%"]}),(0,e.jsxs)("p",{children:["\u5E73\u5747\u7528\u65F6: ",i.avgResponseTime.toFixed(2),"s"]})]}),onOk:S})},lt=function(){z.current.length>0&&(Ce(),Y.ZP.info("\u6D4B\u8BD5\u5DF2\u4E2D\u65AD\uFF0C\u8FDB\u5EA6\u5DF2\u8BB0\u5F55")),S()};(0,s.useEffect)(function(){return l&&(st(),pe.current=Date.now(),r.mode==="timed"&&(B(r.timeLimit),w.current=setInterval(function(){B(function(c){return c<=1?(clearInterval(w.current),it(),0):c-1})},1e3))),function(){w.current&&clearInterval(w.current)}},[l]);var ot=(0,Pe.u)(r.instrumentName),ct=ot.status;return(0,e.jsx)(ae.Z,{open:l,onCancel:lt,footer:null,width:700,title:(0,e.jsxs)("div",{className:"flex justify-between items-center pr-8",children:[(0,e.jsxs)("span",{children:["\u542C\u97F3\u5224\u65AD - ",r.mode==="timed"?"\u9650\u65F6\u6311\u6218":"\u65E0\u9650\u6A21\u5F0F"]}),r.mode==="timed"&&(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsxs)("span",{className:u<10?"text-red-500 font-bold":"",children:["\u5012\u8BA1\u65F6: ",u,"s"]}),(0,e.jsx)(Le.Z,{type:"circle",percent:u/r.timeLimit*100,width:30,showInfo:!1,strokeColor:u<10?"#ff4d4f":"#1890ff"})]})]}),maskClosable:!1,destroyOnClose:!0,children:(0,e.jsxs)("div",{className:"py-4 text-center",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)(k.ZP,{type:"primary",shape:"round",icon:(0,e.jsx)(Ge.Z,{}),size:"large",onClick:function(){return j&&je(j)},loading:at||xe,children:"\u91CD\u653E\u58F0\u97F3"}),(0,e.jsx)("div",{className:"mt-2 text-gray-400 text-xs",children:xe?"\u6B63\u5728\u51C6\u5907\u97F3\u8272...":ct==="loaded"?"\u97F3\u8272\u5DF2\u5C31\u7EEA":"\u97F3\u8272\u52A0\u8F7D\u4E2D\uFF0C\u6682\u7528\u6A21\u62DF\u97F3"})]}),(0,e.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-8",children:E.map(function(c){var i=o.includes(c);return(0,e.jsxs)(k.ZP,{disabled:i,className:"h-24 text-lg font-bold flex flex-col items-center justify-center gap-1 ".concat(i?"opacity-50 border-dashed":""),onClick:function(){return ut(c)},children:[c,X.YD[c]&&(0,e.jsx)("div",{className:"scale-50 h-8 overflow-hidden flex items-center justify-center",children:(0,e.jsx)(Re.Z,{name:c,fingering:X.YD[c],width:60,height:80})})]},c)})}),(0,e.jsxs)("div",{className:"flex justify-between text-gray-500 border-t pt-4",children:[(0,e.jsxs)("span",{children:["\u6B63\u786E\u6B21\u6570: ",H]}),(0,e.jsxs)("span",{children:["\u8FDE\u5BF9\u5956\u52B1: ",tt]}),(0,e.jsxs)("span",{children:["\u51C6\u786E\u7387:"," ",Z>0?(H/Z*100).toFixed(0):0,"%"]})]})]})})},Ve=ze,We={toneType:D.W4,instrumentName:D.OG,toneListGroup:{chords:["C","D","G","Em","Am"]},difficulty:4,mode:"timed",timeLimit:60},$e=function(){var p=K.A.useForm(),l=d()(p,1),r=l[0],S=(0,s.useState)(!1),N=d()(S,2),C=N[0],j=N[1],x=(0,s.useState)(null),b=d()(x,2),y=b[0],E=b[1],T=K.A.useWatch("instrumentName",r)||D.OG;(0,s.useEffect)(function(){(0,te.pr)(T).catch(console.error)},[T]),(0,s.useEffect)(function(){var o=(0,V.Tp)(D.Ry,null);o&&r.setFieldsValue(o)},[r]);var I=function(g,v){(0,V.pd)(D.Ry,v,"\u542C\u97F3\u5224\u65AD\u914D\u7F6E")},m=function(){var o=U()(L()().mark(function g(v){var a,u,B,R;return L()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(a=v.toneListGroup,u=v.toneType,B=v.difficulty,R=[],u==="GuitarChords"?R=a.chords||[]:R=Object.entries(a).filter(function($){var O=d()($,1),Z=O[0];return!isNaN(Number(Z))}).map(function($){var O=d()($,2),Z=O[1];return Z}).flat().filter(Boolean),!(R.length<B)){P.next=6;break}return Y.ZP.error("\u5F53\u524D\u9009\u62E9\u7684\u97F3\u7B26/\u548C\u5F26\u6570\u91CF (".concat(R.length,") \u4E0D\u8DB3\uFF0C\u81F3\u5C11\u9700\u8981\u9009\u62E9 ").concat(B," \u4E2A\u624D\u80FD\u5F00\u59CB\u5F53\u524D\u96BE\u5EA6\u7684\u6D4B\u8BD5\u3002")),P.abrupt("return");case 6:E(v),j(!0);case 8:case"end":return P.stop()}},g)}));return function(v){return o.apply(this,arguments)}}();return(0,e.jsxs)("div",{children:[(0,e.jsxs)(K.A,{form:r,initialValues:We,onValuesChange:I,onFinish:m,submitter:{searchConfig:{submitText:"\u5F00\u59CB\u6D4B\u8BD5"},render:function(g,v){return(0,e.jsx)(be.S,{children:v})}},children:[(0,e.jsx)(Ne.Z,{}),(0,e.jsx)(W.Z,{title:"\u6D4B\u8BD5\u914D\u7F6E",className:"mb-6",children:(0,e.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,e.jsxs)("div",{className:"flex flex-wrap gap-4 border-b pb-4",children:[(0,e.jsx)(Ie.Z,{name:"instrumentName",label:"\u4E50\u5668\u97F3\u8272",options:D.qL,width:"md"}),(0,e.jsx)(ne.Z.Group,{name:"difficulty",label:"\u95EE\u9898\u96BE\u5EA6",options:[{label:"\u7B80\u5355 (2\u90091)",value:2},{label:"\u4E2D\u7B49 (4\u90091)",value:4},{label:"\u56F0\u96BE (6\u90091)",value:6},{label:"\u5730\u72F1 (8\u90091)",value:8}]})]}),(0,e.jsxs)("div",{className:"flex flex-wrap items-center gap-8",children:[(0,e.jsx)(ne.Z.Group,{name:"mode",label:"\u6D4B\u8BD5\u6A21\u5F0F",options:[{label:"\u9650\u65F6\u6311\u6218",value:"timed"},{label:"\u65E0\u9650\u6A21\u5F0F",value:"infinite"}]}),(0,e.jsx)(Ze.Z,{name:["mode"],children:function(g){var v=g.mode;return v==="timed"&&(0,e.jsx)(Ae.Z,{name:"timeLimit",label:"\u65F6\u95F4\u4E0A\u9650 (\u79D2)",width:"xs",min:10,fieldProps:{step:30}})}})]})]})})]}),y&&(0,e.jsx)(Ve,{open:C,settings:y,onCancel:function(){return j(!1)}})]})},He=$e,Ye=t(26068),ue=t.n(Ye),we=t(43969),Qe=t(52402),q=t(64451),ie=t(20293),Ue=t(88645),le=function(p){var l=p.data,r=p.label,S=p.color,N=S===void 0?"":S;if(l.length===0)return(0,e.jsx)(we.Z,{description:"\u6682\u65E0\u6570\u636E"});var C=600,j=200,x=20,b=C-x*2,y=j-x*2,E=Math.max.apply(Math,J()(l).concat([1])),T=0,I=E-T,m=l.map(function(o,g){var v=x+g/(l.length-1||1)*b,a=x+y-(o-T)/I*y;return"".concat(v,",").concat(a)}).join(" ");return(0,e.jsxs)("div",{className:"w-full overflow-x-auto",children:[(0,e.jsx)("div",{className:"font-semibold mb-2",children:r}),(0,e.jsxs)("svg",{width:C,height:j,className:"bg-gray-50 rounded",children:[[0,.25,.5,.75,1].map(function(o){return(0,e.jsx)("line",{x1:x,y1:x+y*o,x2:C-x,y2:x+y*o,stroke:"#e5e7eb",strokeDasharray:"4"},o)}),(0,e.jsx)("polyline",{fill:"none",stroke:N,strokeWidth:"3",strokeLinejoin:"round",points:m}),l.map(function(o,g){var v=x+g/(l.length-1||1)*b,a=x+y-(o-T)/I*y;return(0,e.jsx)("circle",{cx:v,cy:a,r:"4",fill:N,onMouseEnter:function(){}},g)})]}),(0,e.jsxs)("div",{className:"flex justify-between text-xs text-gray-400 mt-1 px-5",children:[(0,e.jsx)("span",{children:"\u8F83\u65E9"}),(0,e.jsx)("span",{children:"\u6700\u8FD1"})]})]})},Ke=function(){var p=(0,s.useState)(20),l=d()(p,2),r=l[0],S=l[1],N=(0,s.useState)("all"),C=d()(N,2),j=C[0],x=C[1],b=(0,s.useState)("all"),y=d()(b,2),E=y[0],T=y[1],I=(0,s.useMemo)(function(){return se()},[]),m=(0,s.useMemo)(function(){var a=I;return j!=="all"&&(a=a.filter(function(u){return u.difficulty===j})),E!=="all"&&(a=a.filter(function(u){return u.mode===E})),a.slice(-r)},[I,r,j,E]),o=(0,s.useMemo)(function(){return m.length===0?0:m.reduce(function(a,u){return a+u.accuracy},0)/m.length},[m]),g=(0,s.useMemo)(function(){return m.length===0?0:m.reduce(function(a,u){return a+u.avgResponseTime},0)/m.length},[m]),v=function(){Oe(),window.location.reload()};return(0,e.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,e.jsx)(W.Z,{title:"\u7EDF\u8BA1\u914D\u7F6E",size:"small",children:(0,e.jsxs)(Qe.Z,{wrap:!0,size:16,children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"mr-2",children:"\u5386\u53F2\u957F\u5EA6:"}),(0,e.jsx)(q.Z,{value:r,onChange:S,style:{width:100},options:[{label:"\u6700\u8FD110\u6B21",value:10},{label:"\u6700\u8FD120\u6B21",value:20},{label:"\u6700\u8FD150\u6B21",value:50},{label:"\u6700\u8FD1100\u6B21",value:100}]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"mr-2",children:"\u96BE\u5EA6\u7B5B\u9009:"}),(0,e.jsx)(q.Z,{value:j,onChange:x,style:{width:120},options:[{label:"\u5168\u90E8\u96BE\u5EA6",value:"all"},{label:"\u7B80\u5355 (2)",value:2},{label:"\u4E2D\u7B49 (4)",value:4},{label:"\u56F0\u96BE (6)",value:6},{label:"\u5730\u72F1 (8)",value:8}]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"mr-2",children:"\u6A21\u5F0F\u7B5B\u9009:"}),(0,e.jsx)(q.Z,{value:E,onChange:T,style:{width:120},options:[{label:"\u5168\u90E8\u6A21\u5F0F",value:"all"},{label:"\u9650\u65F6\u6311\u6218",value:"timed"},{label:"\u65E0\u9650\u6A21\u5F0F",value:"infinite"}]})]}),(0,e.jsx)(k.ZP,{danger:!0,size:"small",onClick:v,children:"\u91CD\u7F6E\u6240\u6709\u6570\u636E"})]})}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)(W.Z,{size:"small",children:[(0,e.jsx)(ie.Z,{title:"\u5E73\u5747\u51C6\u786E\u7387",value:o*100,precision:1,suffix:"%",valueStyle:{color:"#3f8600"}}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(le,{data:m.map(function(a){return a.accuracy*100}),label:"\u51C6\u786E\u7387\u8D8B\u52BF (%)",color:"#3f8600"})})]}),(0,e.jsxs)(W.Z,{size:"small",children:[(0,e.jsx)(ie.Z,{title:"\u5E73\u5747\u53CD\u5E94\u65F6\u95F4",value:g,precision:2,suffix:"s",valueStyle:{color:"#1890ff"}}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(le,{data:m.map(function(a){return a.avgResponseTime}),label:"\u53CD\u5E94\u65F6\u95F4\u8D8B\u52BF (\u79D2)",color:"#1890ff"})})]})]}),(0,e.jsx)(W.Z,{title:"\u8BE6\u7EC6\u5386\u53F2",size:"small",children:(0,e.jsx)(Ue.Z,{dataSource:m.map(function(a,u){return ue()(ue()({},a),{},{key:u})}),columns:[{title:"\u65F6\u95F4",dataIndex:"timestamp",render:function(u){return new Date(u).toLocaleString()},responsive:["md"]},{title:"\u96BE\u5EA6",dataIndex:"difficulty",render:function(u){return"".concat(u,"\u90091")}},{title:"\u6A21\u5F0F",dataIndex:"mode",render:function(u){return u==="timed"?"\u9650\u65F6":"\u65E0\u9650"}},{title:"\u5F97\u5206",dataIndex:"correctCount"},{title:"\u51C6\u786E\u7387",dataIndex:"accuracy",render:function(u){return"".concat((u*100).toFixed(0),"%")}},{title:"\u8017\u65F6",dataIndex:"avgResponseTime",render:function(u){return"".concat(u.toFixed(2),"s")}}],pagination:{pageSize:5},size:"small"})})]})},Je=Ke,Xe=function(){var p=(0,s.useState)("practice"),l=d()(p,2),r=l[0],S=l[1];return(0,e.jsxs)(Ee._z,{header:{title:"\u542C\u97F3\u5224\u65AD"},tabList:[{tab:"\u529F\u80FD\u7EC3\u4E60",key:"practice"},{tab:"\u7EDF\u8BA1\u5206\u6790",key:"statistics"}],tabActiveKey:r,onTabChange:S,children:[r==="practice"&&(0,e.jsx)(He,{}),r==="statistics"&&(0,e.jsx)(Je,{})]})},ke=Xe}}]);
