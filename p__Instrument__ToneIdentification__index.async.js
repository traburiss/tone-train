"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[132],{54990:function(ht,te,t){t.r(te),t.d(te,{default:function(){return et}});var Ee=t(48305),f=t.n(Ee),Ne=t(5318),s=t(75271),Ae=t(90228),L=t.n(Ae),Ze=t(87999),U=t.n(Ze),Be=t(2917),C=t(20395),w=t(88489),ne=t(65535),K=t(40624),Ie=t(21004),J=t(24486),ae=t(84611),Pe=t(97375),Re=t(1501),H=t(30933),W=t(45803),Ge=t(15558),X=t.n(Ge),Le=t(53034),Oe=t(85344),k=t(4416),ze=t(99430),re=t(1073),Me=t(45190),se=t(70439),ue=t(55248),ie=function(){return(0,w.fy)(C.Ry,[])},we=function(y){var c=ie();c.push(y),c.length>100&&c.shift(),(0,w._Y)(C.Ry,c,"\u542C\u97F3\u5224\u65AD\u7EDF\u8BA1\u6570\u636E")},We=function(){(0,w._Y)(C.Ry,[],"\u542C\u97F3\u5224\u65AD\u7EDF\u8BA1\u6570\u636E")},e=t(52676),O=null,Ve=function(y){var c=y.open,a=y.settings,j=y.onCancel,E=(0,s.useState)(null),F=f()(E,2),x=F[0],g=F[1],N=(0,s.useState)([]),S=f()(N,2),T=S[0],D=S[1],A=(0,s.useState)([]),h=f()(A,2),d=h[0],p=h[1],v=(0,s.useState)(a.timeLimit),r=f()(v,2),u=r[0],P=r[1],R=(0,s.useState)(0),de=f()(R,2),G=de[1],V=(0,s.useState)(0),z=f()(V,2),Z=z[0],fe=z[1],tt=(0,s.useState)(0),ve=f()(tt,2),$=ve[0],nt=ve[1],at=(0,s.useState)(0),me=f()(at,2),rt=me[0],_=me[1],st=(0,s.useState)(!1),he=f()(st,2),ut=he[0],xe=he[1],it=(0,s.useState)(!0),ge=f()(it,2),pe=ge[0],ye=ge[1],lt=(0,s.useState)(!1),Se=f()(lt,2),ee=Se[0],je=Se[1],Ce=(0,s.useRef)(0),Fe=(0,s.useRef)(0),Q=(0,s.useRef)(null),M=(0,s.useRef)([]),Y=(0,s.useMemo)(function(){var i=a.toneListGroup,l=a.toneType;return l==="GuitarChords"?i.chords||[]:Object.entries(i).filter(function(o){var m=f()(o,1),n=m[0];return!isNaN(Number(n))}).map(function(o){var m=f()(o,2),n=m[1];return n}).flat().filter(Boolean)},[a]),be=function(){var i=U()(L()().mark(function l(o){var m,n;return L()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(O){b.next=2;break}return b.abrupt("return");case 2:xe(!0),m=(a.toneDuration||1e3)/1e3,a.toneType==="GuitarChords"?(n=(0,k.UV)(o),n.length>0?O.triggerAttackRelease(n,m):O.triggerAttackRelease(o,m)):O.triggerAttackRelease(o,m),setTimeout(function(){return xe(!1)},m*1e3);case 6:case"end":return b.stop()}},l)}));return function(o){return i.apply(this,arguments)}}(),Te=function(){if(Y.length===0){H.ZP.error("\u672A\u9009\u62E9\u4EFB\u4F55\u97F3\u9636\u6216\u548C\u5F26"),j();return}var l=Y[Math.floor(Math.random()*Y.length)];g(l),p([]),je(!1);var o=[l],m=Y.filter(function(b){return b!==l}),n=a.difficulty-1,B=m.sort(function(){return .5-Math.random()});o.push.apply(o,X()(B.slice(0,n))),D(o.sort(function(){return .5-Math.random()})),be(l),Fe.current=Date.now()},ot=function(){var i=U()(L()().mark(function l(){var o;return L()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return ye(!0),n.prev=1,n.next=4,(0,ne.pr)(a.instrumentName);case 4:o=n.sent,O=o,n.next=12;break;case 8:n.prev=8,n.t0=n.catch(1),console.error("Failed to load instrument, falling back to PolySynth",n.t0),O=new ue.v2(ue.WV).toDestination();case 12:ye(!1),Te();case 14:case"end":return n.stop()}},l,null,[[1,8]])}));return function(){return i.apply(this,arguments)}}(),ct=function(l){if(l===x){var o=(Date.now()-Fe.current)/1e3;M.current.push({timeTaken:o,correct:d.length===0}),G(function(n){return n+1}),nt(function(n){return n+1}),fe(function(n){return n+1});var m=d.length===0;_(m?function(n){var B=n+1;return B%3===0&&a.mode==="timed"&&(P(function(b){return b+5}),H.ZP.success("\u8FDE\u5BF93\u6B21\uFF0C\u65F6\u95F4+5s\uFF01")),B}:0),je(!0),setTimeout(Te,a.toneWait||1e3)}else d.includes(l)||(p(function(n){return[].concat(X()(n),[l])}),fe(function(n){return n+1}),_(0))},De=function(){if(M.current.length===0)return null;var l=(Date.now()-Ce.current)/1e3,o=Z>0?$/Z:0,m=M.current.reduce(function(B,b){return B+b.timeTaken},0)/M.current.length,n={timestamp:Date.now(),difficulty:a.difficulty,mode:a.mode,correctCount:$,totalQuestions:M.current.length,accuracy:o,avgResponseTime:m,duration:l};return we(n),{accuracy:o,avgResponseTime:m}},dt=function(){var l=De();if(!l){j();return}re.Z.info({title:"\u6D4B\u8BD5\u7ED3\u675F",content:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{children:["\u6B63\u786E\u6570\u91CF: ",$]}),(0,e.jsxs)("p",{children:["\u51C6\u786E\u7387: ",(l.accuracy*100).toFixed(1),"%"]}),(0,e.jsxs)("p",{children:["\u5E73\u5747\u7528\u65F6: ",l.avgResponseTime.toFixed(2),"s"]})]}),onOk:j})},ft=function(){M.current.length>0&&(De(),H.ZP.info("\u6D4B\u8BD5\u5DF2\u4E2D\u65AD\uFF0C\u8FDB\u5EA6\u5DF2\u8BB0\u5F55")),j()};(0,s.useEffect)(function(){return c&&(ot(),Ce.current=Date.now(),a.mode==="timed"&&(P(a.timeLimit),Q.current=setInterval(function(){P(function(i){return i<=1?(clearInterval(Q.current),dt(),0):i-1})},1e3))),function(){Q.current&&clearInterval(Q.current)}},[c]);var vt=(0,Oe.u)(a.instrumentName),mt=vt.status;return(0,e.jsx)(re.Z,{open:c,onCancel:ft,footer:null,width:700,title:(0,e.jsxs)("div",{className:"flex justify-between items-center pr-8",children:[(0,e.jsxs)("span",{children:["\u542C\u97F3\u5224\u65AD - ",a.mode==="timed"?"\u9650\u65F6\u6311\u6218":"\u65E0\u9650\u6A21\u5F0F"]}),a.mode==="timed"&&(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsxs)("span",{className:u<10?"text-red-500 font-bold":"",children:["\u5012\u8BA1\u65F6: ",u,"s"]}),(0,e.jsx)(Me.Z,{type:"circle",percent:u/a.timeLimit*100,size:{width:30},showInfo:!1,strokeColor:u<10?"#ff4d4f":"#1890ff"})]})]}),maskClosable:!1,destroyOnHidden:!0,children:(0,e.jsxs)("div",{className:"py-4 text-center",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)(se.ZP,{type:"primary",shape:"round",icon:(0,e.jsx)(ze.Z,{}),size:"large",onClick:function(){return x&&be(x)},loading:ut||pe,children:"\u91CD\u653E\u58F0\u97F3"}),(0,e.jsx)("div",{className:"mt-2 text-gray-400 text-xs",children:pe?"\u6B63\u5728\u51C6\u5907\u97F3\u8272...":mt==="loaded"?"\u97F3\u8272\u5DF2\u5C31\u7EEA":"\u97F3\u8272\u52A0\u8F7D\u4E2D\uFF0C\u6682\u7528\u6A21\u62DF\u97F3"})]}),(0,e.jsx)("div",{className:"grid gap-2 mb-6",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:T.map(function(i){var l=ee&&i===x,o=d.includes(i),m=ee&&i!==x,n=a.toneType==="GuitarChords";return(0,e.jsxs)("div",{className:`
                  flex flex-col items-center justify-center p-0.5 border rounded transition-all select-none overflow-hidden
                  `.concat(l?"bg-green-50 border-green-500 shadow-md scale-105 z-10":o?"bg-red-50 border-red-200 opacity-60 cursor-not-allowed":m?"bg-gray-50 border-gray-100 opacity-30 cursor-not-allowed":"bg-white border-blue-50 shadow-sm hover:border-blue-300 active:scale-95 cursor-pointer",`
                `),onClick:function(){return!o&&!ee&&ct(i)},children:[(0,e.jsx)("div",{className:"font-bold truncate w-full text-center leading-tight ".concat(l?"text-green-600 text-sm":o?"text-red-500":n?"text-[10px] text-gray-400":"text-sm text-gray-700"),children:i}),k.YD[i]&&(0,e.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,e.jsx)(Le.Z,{name:i,fingering:k.YD[i],width:60,height:80,showName:!1})})]},i)})}),(0,e.jsxs)("div",{className:"flex justify-between text-gray-500 border-t pt-4",children:[(0,e.jsxs)("span",{children:["\u6B63\u786E\u6B21\u6570: ",$]}),(0,e.jsxs)("span",{children:["\u8FDE\u5BF9\u5956\u52B1: ",rt]}),(0,e.jsxs)("span",{children:["\u51C6\u786E\u7387:"," ",Z>0?($/Z*100).toFixed(0):0,"%"]})]})]})})},$e=Ve,He={toneType:C.W4,instrumentName:C.OG,toneListGroup:{chords:["C","D","G","Em","Am"]},difficulty:2,mode:"timed",timeLimit:60,toneDuration:1e3,toneWait:1500},Qe=function(){var y=K.A.useForm(),c=f()(y,1),a=c[0],j=(0,s.useState)(!1),E=f()(j,2),F=E[0],x=E[1],g=(0,s.useState)(null),N=f()(g,2),S=N[0],T=N[1],D=K.A.useWatch("instrumentName",a)||C.OG;(0,s.useEffect)(function(){(0,ne.pr)(D).catch(console.error)},[D]),(0,s.useEffect)(function(){var d=(0,w.Tp)(C.Ry,null);d&&a.setFieldsValue(d)},[a]);var A=function(p,v){(0,w.pd)(C.Ry,v,"\u542C\u97F3\u5224\u65AD\u914D\u7F6E")},h=function(){var d=U()(L()().mark(function p(v){var r,u,P,R;return L()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(r=v.toneListGroup,u=v.toneType,P=v.difficulty,R=[],u==="GuitarChords"?R=r.chords||[]:R=Object.entries(r).filter(function(V){var z=f()(V,1),Z=z[0];return!isNaN(Number(Z))}).map(function(V){var z=f()(V,2),Z=z[1];return Z}).flat().filter(Boolean),!(R.length<P)){G.next=6;break}return H.ZP.error("\u5F53\u524D\u9009\u62E9\u7684\u97F3\u7B26/\u548C\u5F26\u6570\u91CF (".concat(R.length,") \u4E0D\u8DB3\uFF0C\u81F3\u5C11\u9700\u8981\u9009\u62E9 ").concat(P," \u4E2A\u624D\u80FD\u5F00\u59CB\u5F53\u524D\u96BE\u5EA6\u7684\u6D4B\u8BD5\u3002")),G.abrupt("return");case 6:T(v),x(!0);case 8:case"end":return G.stop()}},p)}));return function(v){return d.apply(this,arguments)}}();return(0,e.jsxs)("div",{children:[(0,e.jsxs)(K.A,{form:a,initialValues:He,onValuesChange:A,onFinish:h,submitter:{searchConfig:{submitText:"\u5F00\u59CB\u6D4B\u8BD5"},render:function(p,v){return(0,e.jsx)(Ie.S,{children:v})}},children:[(0,e.jsx)(Be.Z,{}),(0,e.jsx)(W.Z,{title:"\u6D4B\u8BD5\u914D\u7F6E",className:"mb-6",children:(0,e.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-4 border-b pb-4",children:[(0,e.jsx)(J.Z.Group,{name:"instrumentName",label:"\u4E50\u5668\u97F3\u8272",radioType:"button",fieldProps:{buttonStyle:"solid",size:"small"},options:C.qL}),(0,e.jsx)(J.Z.Group,{name:"difficulty",label:"\u95EE\u9898\u96BE\u5EA6",radioType:"button",fieldProps:{buttonStyle:"solid",size:"small"},options:[{label:"\u7B80\u5355 (2\u90091)",value:2},{label:"\u4E2D\u7B49 (4\u90091)",value:4},{label:"\u56F0\u96BE (6\u90091)",value:6},{label:"\u5730\u72F1 (8\u90091)",value:8}]})]}),(0,e.jsxs)("div",{className:"flex flex-wrap gap-x-8 gap-y-0 border-b pb-4",children:[(0,e.jsx)(ae.Z,{name:"toneDuration",label:"\u97F3\u64AD\u653E\u65F6\u957F",min:100,max:5e3,step:100,width:"md",fieldProps:{tooltip:{formatter:C.QZ}}}),(0,e.jsx)(ae.Z,{name:"toneWait",label:"\u97F3\u64AD\u653E\u5B8C\u7B49\u5F85\u65F6\u957F",min:100,max:5e3,step:100,width:"md",fieldProps:{tooltip:{formatter:C.QZ}}})]}),(0,e.jsxs)("div",{className:"flex flex-wrap items-center gap-8",children:[(0,e.jsx)(J.Z.Group,{name:"mode",label:"\u6D4B\u8BD5\u6A21\u5F0F",radioType:"button",fieldProps:{buttonStyle:"solid",size:"small"},options:[{label:"\u65E0\u9650\u6A21\u5F0F",value:"infinite"},{label:"\u9650\u65F6\u6311\u6218",value:"timed"}]}),(0,e.jsx)(Pe.Z,{name:["mode"],children:function(p){var v=p.mode;return v==="timed"&&(0,e.jsx)(Re.Z,{name:"timeLimit",label:"\u65F6\u95F4\u4E0A\u9650 (\u79D2)",width:"xs",min:10,fieldProps:{step:10}})}})]})]})})]}),S&&(0,e.jsx)($e,{open:F,settings:S,onCancel:function(){return x(!1)}})]})},Ye=Qe,Ue=t(26068),le=t.n(Ue),Ke=t(43969),Je=t(52402),q=t(64451),oe=t(20293),Xe=t(88645),ce=function(y){var c=y.data,a=y.label,j=y.color,E=j===void 0?"":j;if(c.length===0)return(0,e.jsx)(Ke.Z,{description:"\u6682\u65E0\u6570\u636E"});var F=600,x=200,g=20,N=F-g*2,S=x-g*2,T=Math.max.apply(Math,X()(c).concat([1])),D=0,A=T-D,h=c.map(function(d,p){var v=g+p/(c.length-1||1)*N,r=g+S-(d-D)/A*S;return"".concat(v,",").concat(r)}).join(" ");return(0,e.jsxs)("div",{className:"w-full overflow-x-auto",children:[(0,e.jsx)("div",{className:"font-semibold mb-2",children:a}),(0,e.jsxs)("svg",{width:F,height:x,className:"bg-gray-50 rounded",children:[[0,.25,.5,.75,1].map(function(d){return(0,e.jsx)("line",{x1:g,y1:g+S*d,x2:F-g,y2:g+S*d,stroke:"#e5e7eb",strokeDasharray:"4"},d)}),(0,e.jsx)("polyline",{fill:"none",stroke:E,strokeWidth:"3",strokeLinejoin:"round",points:h}),c.map(function(d,p){var v=g+p/(c.length-1||1)*N,r=g+S-(d-D)/A*S;return(0,e.jsx)("circle",{cx:v,cy:r,r:"4",fill:E,onMouseEnter:function(){}},p)})]}),(0,e.jsxs)("div",{className:"flex justify-between text-xs text-gray-400 mt-1 px-5",children:[(0,e.jsx)("span",{children:"\u8F83\u65E9"}),(0,e.jsx)("span",{children:"\u6700\u8FD1"})]})]})},ke=function(){var y=(0,s.useState)(20),c=f()(y,2),a=c[0],j=c[1],E=(0,s.useState)("all"),F=f()(E,2),x=F[0],g=F[1],N=(0,s.useState)("all"),S=f()(N,2),T=S[0],D=S[1],A=(0,s.useMemo)(function(){return ie()},[]),h=(0,s.useMemo)(function(){var r=A;return x!=="all"&&(r=r.filter(function(u){return u.difficulty===x})),T!=="all"&&(r=r.filter(function(u){return u.mode===T})),r.slice(-a)},[A,a,x,T]),d=(0,s.useMemo)(function(){return h.length===0?0:h.reduce(function(r,u){return r+u.accuracy},0)/h.length},[h]),p=(0,s.useMemo)(function(){return h.length===0?0:h.reduce(function(r,u){return r+u.avgResponseTime},0)/h.length},[h]),v=function(){We(),window.location.reload()};return(0,e.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,e.jsx)(W.Z,{title:"\u7EDF\u8BA1\u914D\u7F6E",size:"small",children:(0,e.jsxs)(Je.Z,{wrap:!0,size:16,children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"mr-2",children:"\u5386\u53F2\u957F\u5EA6:"}),(0,e.jsx)(q.Z,{value:a,onChange:j,style:{width:100},options:[{label:"\u6700\u8FD110\u6B21",value:10},{label:"\u6700\u8FD120\u6B21",value:20},{label:"\u6700\u8FD150\u6B21",value:50},{label:"\u6700\u8FD1100\u6B21",value:100}]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"mr-2",children:"\u96BE\u5EA6\u7B5B\u9009:"}),(0,e.jsx)(q.Z,{value:x,onChange:g,style:{width:120},options:[{label:"\u5168\u90E8\u96BE\u5EA6",value:"all"},{label:"\u7B80\u5355 (2)",value:2},{label:"\u4E2D\u7B49 (4)",value:4},{label:"\u56F0\u96BE (6)",value:6},{label:"\u5730\u72F1 (8)",value:8}]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"mr-2",children:"\u6A21\u5F0F\u7B5B\u9009:"}),(0,e.jsx)(q.Z,{value:T,onChange:D,style:{width:120},options:[{label:"\u5168\u90E8\u6A21\u5F0F",value:"all"},{label:"\u9650\u65F6\u6311\u6218",value:"timed"},{label:"\u65E0\u9650\u6A21\u5F0F",value:"infinite"}]})]}),(0,e.jsx)(se.ZP,{danger:!0,size:"small",onClick:v,children:"\u91CD\u7F6E\u6240\u6709\u6570\u636E"})]})}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)(W.Z,{size:"small",children:[(0,e.jsx)(oe.Z,{title:"\u5E73\u5747\u51C6\u786E\u7387",value:d*100,precision:1,suffix:"%",valueStyle:{color:"#3f8600"}}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(ce,{data:h.map(function(r){return r.accuracy*100}),label:"\u51C6\u786E\u7387\u8D8B\u52BF (%)",color:"#3f8600"})})]}),(0,e.jsxs)(W.Z,{size:"small",children:[(0,e.jsx)(oe.Z,{title:"\u5E73\u5747\u53CD\u5E94\u65F6\u95F4",value:p,precision:2,suffix:"s",valueStyle:{color:"#1890ff"}}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(ce,{data:h.map(function(r){return r.avgResponseTime}),label:"\u53CD\u5E94\u65F6\u95F4\u8D8B\u52BF (\u79D2)",color:"#1890ff"})})]})]}),(0,e.jsx)(W.Z,{title:"\u8BE6\u7EC6\u5386\u53F2",size:"small",children:(0,e.jsx)(Xe.Z,{dataSource:h.map(function(r,u){return le()(le()({},r),{},{key:u})}),columns:[{title:"\u65F6\u95F4",dataIndex:"timestamp",render:function(u){return new Date(u).toLocaleString()},responsive:["md"]},{title:"\u96BE\u5EA6",dataIndex:"difficulty",render:function(u){return"".concat(u,"\u90091")}},{title:"\u6A21\u5F0F",dataIndex:"mode",render:function(u){return u==="timed"?"\u9650\u65F6":"\u65E0\u9650"}},{title:"\u5F97\u5206",dataIndex:"correctCount"},{title:"\u51C6\u786E\u7387",dataIndex:"accuracy",render:function(u){return"".concat((u*100).toFixed(0),"%")}},{title:"\u8017\u65F6",dataIndex:"avgResponseTime",render:function(u){return"".concat(u.toFixed(2),"s")}}],pagination:{pageSize:5},size:"small"})})]})},qe=ke,_e=function(){var y=(0,s.useState)("practice"),c=f()(y,2),a=c[0],j=c[1];return(0,e.jsxs)(Ne._z,{header:{title:"\u542C\u97F3\u5224\u65AD"},tabList:[{tab:"\u529F\u80FD\u7EC3\u4E60",key:"practice"},{tab:"\u7EDF\u8BA1\u5206\u6790",key:"statistics"}],tabActiveKey:a,onTabChange:j,children:[a==="practice"&&(0,e.jsx)(Ye,{}),a==="statistics"&&(0,e.jsx)(qe,{})]})},et=_e}}]);
