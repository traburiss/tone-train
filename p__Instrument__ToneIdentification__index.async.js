"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[132],{97166:function(xt,se,a){a.r(se),a.d(se,{default:function(){return nt}});var Re=a(48305),m=a.n(Re),Ge=a(5318),V=a(82238),s=a(75271),Ae=a(26068),K=a.n(Ae),Fe=a(90228),z=a.n(Fe),De=a(87999),q=a.n(De),Le=a(99788),R=a(67849),$=a(6946),oe=a(21017),_=a(40624),Oe=a(21004),ee=a(24486),le=a(84611),ze=a(97375),we=a(1501),J=a(30933),H=a(45803),We=a(15558),te=a.n(We),Ee=a(7033),Ve=a(32613),ae=a(85747),$e=a(82773),ce=a(1073),He=a(45190),de=a(70439),ue=a(55248),fe=function(){return(0,$.fy)(R.Ry,[])},Ye=function(S){var f=fe();f.push(S),f.length>100&&f.shift(),(0,$._Y)(R.Ry,f,"\u542C\u97F3\u5224\u65AD\u7EDF\u8BA1\u6570\u636E")},Qe=function(){(0,$._Y)(R.Ry,[],"\u542C\u97F3\u5224\u65AD\u7EDF\u8BA1\u6570\u636E")},e=a(52676),w=null,Be=function(S){var f=S.open,i=S.settings,C=S.onCancel,T=(0,s.useState)(null),N=m()(T,2),y=N[0],A=N[1],p=(0,s.useState)([]),I=m()(p,2),j=I[0],d=I[1],n=(0,s.useState)([]),Z=m()(n,2),v=Z[0],b=Z[1],g=(0,s.useState)(i.timeLimit),M=m()(g,2),t=M[0],o=M[1],X=(0,s.useState)(0),Y=m()(X,2),O=Y[1],ge=(0,s.useState)(0),F=m()(ge,2),D=F[0],W=F[1],Q=(0,s.useState)(0),he=m()(Q,2),B=he[0],rt=he[1],it=(0,s.useState)(0),xe=m()(it,2),st=xe[0],re=xe[1],ot=(0,s.useState)(!1),ye=m()(ot,2),lt=ye[0],pe=ye[1],ct=(0,s.useState)(!0),Se=m()(ct,2),je=Se[0],Me=Se[1],dt=(0,s.useState)(!1),be=m()(dt,2),ie=be[0],Ce=be[1],x=(0,V.useIntl)(),Te=(0,s.useRef)(0),Ne=(0,s.useRef)(0),U=(0,s.useRef)(null),E=(0,s.useRef)([]),k=(0,s.useMemo)(function(){var l=i.toneListGroup,c=i.toneType;return c==="GuitarChords"?l.chords||[]:Object.entries(l).filter(function(u){var h=m()(u,1),r=h[0];return!isNaN(Number(r))}).map(function(u){var h=m()(u,2),r=h[1];return r}).flat().filter(Boolean)},[i]),Ie=function(){var l=q()(z()().mark(function c(u){var h,r;return z()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(w){P.next=2;break}return P.abrupt("return");case 2:pe(!0),h=(i.toneDuration||1e3)/1e3,i.toneType==="GuitarChords"?(r=(0,ae.UV)(u),r.length>0?w.triggerAttackRelease(r,h):w.triggerAttackRelease(u,h)):w.triggerAttackRelease(u,h),setTimeout(function(){return pe(!1)},h*1e3);case 6:case"end":return P.stop()}},c)}));return function(u){return l.apply(this,arguments)}}(),Ze=function(){if(k.length===0){J.ZP.error(x.formatMessage({id:"game.error.no-tones"})),C();return}var c=k[Math.floor(Math.random()*k.length)];A(c),b([]),Ce(!1);var u=[c],h=k.filter(function(P){return P!==c}),r=i.difficulty-1,G=h.sort(function(){return .5-Math.random()});u.push.apply(u,te()(G.slice(0,r))),d(u.sort(function(){return .5-Math.random()})),Ie(c),Ne.current=Date.now()},ut=function(){var l=q()(z()().mark(function c(){var u;return z()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return Me(!0),r.prev=1,r.next=4,(0,oe.pr)(i.instrumentName);case 4:u=r.sent,w=u,r.next=12;break;case 8:r.prev=8,r.t0=r.catch(1),console.error("Failed to load instrument, falling back to PolySynth",r.t0),w=new ue.v2(ue.WV).toDestination();case 12:Me(!1),Ze();case 14:case"end":return r.stop()}},c,null,[[1,8]])}));return function(){return l.apply(this,arguments)}}(),ft=function(c){if(c===y){var u=(Date.now()-Ne.current)/1e3;E.current.push({timeTaken:u,correct:v.length===0}),O(function(r){return r+1}),rt(function(r){return r+1}),W(function(r){return r+1});var h=v.length===0;re(h?function(r){var G=r+1;return G%3===0&&i.mode==="timed"&&(o(function(P){return P+5}),J.ZP.success(x.formatMessage({id:"game.success.combo"},{count:G,bonus:5}))),G}:0),Ce(!0),setTimeout(Ze,i.toneWait||1e3)}else v.includes(c)||(b(function(r){return[].concat(te()(r),[c])}),W(function(r){return r+1}),re(0))},Pe=function(){if(E.current.length===0)return null;var c=(Date.now()-Te.current)/1e3,u=D>0?B/D:0,h=E.current.reduce(function(G,P){return G+P.timeTaken},0)/E.current.length,r={timestamp:Date.now(),difficulty:i.difficulty,mode:i.mode,correctCount:B,totalQuestions:E.current.length,accuracy:u,avgResponseTime:h,duration:c};return Ye(r),{accuracy:u,avgResponseTime:h}},mt=function(){var c=Pe();if(!c){C();return}ce.Z.info({title:x.formatMessage({id:"game.over.title"}),content:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:x.formatMessage({id:"game.over.correct-count"},{count:B})}),(0,e.jsx)("p",{children:x.formatMessage({id:"game.over.accuracy"},{accuracy:(c.accuracy*100).toFixed(1)})}),(0,e.jsx)("p",{children:x.formatMessage({id:"game.over.avg-time"},{time:c.avgResponseTime.toFixed(2)})})]}),onOk:C})},vt=function(){E.current.length>0&&(Pe(),J.ZP.info(x.formatMessage({id:"game.cancel.info"}))),C()};(0,s.useEffect)(function(){return f&&(ut(),Te.current=Date.now(),i.mode==="timed"&&(o(i.timeLimit),U.current=setInterval(function(){o(function(l){return l<=1?(U.current&&clearInterval(U.current),mt(),0):l-1})},1e3))),function(){U.current&&clearInterval(U.current)}},[f]);var gt=(0,Ve.u)(i.instrumentName),ht=gt.status;return(0,e.jsx)(ce.Z,{open:f,onCancel:vt,footer:null,destroyOnHidden:!0,width:"90%",style:{maxWidth:800},centered:!0,maskClosable:!1,title:(0,e.jsxs)("div",{className:"flex justify-between items-center pr-8",children:[(0,e.jsxs)("span",{children:[x.formatMessage({id:"game.title.prefix"}),i.mode==="timed"?x.formatMessage({id:"tone-identification.mode.timed"}):x.formatMessage({id:"tone-identification.mode.infinite"})]}),i.mode==="timed"&&(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("span",{className:t<10?"text-red-500 font-bold":"",children:x.formatMessage({id:"game.time-left"},{time:t})}),(0,e.jsx)(He.Z,{type:"circle",percent:t/i.timeLimit*100,size:{width:30},showInfo:!1,strokeColor:t<10?"#ff4d4f":"#1890ff"})]})]}),children:(0,e.jsxs)("div",{className:"py-4 text-center",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)(de.ZP,{type:"primary",shape:"round",icon:(0,e.jsx)($e.Z,{}),size:"large",onClick:function(){return y&&Ie(y)},loading:lt||je,children:x.formatMessage({id:"game.replay-sound"})}),(0,e.jsx)("div",{className:"mt-2 text-gray-400 text-xs",children:je?x.formatMessage({id:"game.preparing-instrument"}):ht==="loaded"?x.formatMessage({id:"game.instrument-ready"}):x.formatMessage({id:"game.instrument-loading-midi"})})]}),(0,e.jsx)("div",{className:"grid gap-2 mb-6",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:j.map(function(l){var c=ie&&l===y,u=v.includes(l),h=ie&&l!==y,r=i.toneType==="GuitarChords";return(0,e.jsxs)("div",{className:`
                  flex flex-col items-center justify-center p-0.5 border rounded transition-all select-none overflow-hidden
                  `.concat(c?"bg-green-50 border-green-500 shadow-md scale-105 z-10":u?"bg-red-50 border-red-200 opacity-60 cursor-not-allowed":h?"bg-gray-50 border-gray-100 opacity-30 cursor-not-allowed":"bg-white border-blue-50 shadow-sm hover:border-blue-300 active:scale-95 cursor-pointer",`
                `),onClick:function(){return!u&&!ie&&ft(l)},children:[(0,e.jsx)("div",{className:"font-bold truncate w-full text-center leading-tight ".concat(c?"text-green-600 text-sm":u?"text-red-500":r?"text-[10px] text-gray-400":"text-sm text-gray-700"),children:l}),ae.YD[l]&&(0,e.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,e.jsx)(Ee.Z,{name:l,fingering:ae.YD[l],width:60,height:80,showName:!1})})]},l)})}),(0,e.jsxs)("div",{className:"flex justify-between text-gray-500 border-t pt-4",children:[(0,e.jsx)("span",{children:x.formatMessage({id:"game.correct-count-title"},{count:B})}),(0,e.jsx)("span",{children:x.formatMessage({id:"game.combo-bonus"},{count:st})}),(0,e.jsx)("span",{children:x.formatMessage({id:"game.accuracy-title"},{accuracy:D>0?(B/D*100).toFixed(0):0})})]})]})})},Ue=Be,Ke={toneType:R.W4,instrumentName:R.OG,toneListGroup:{chords:["C","D","G","Em","Am"]},difficulty:2,mode:"timed",timeLimit:60,toneDuration:1e3,toneWait:1500},Je=function(){var S=_.A.useForm(),f=m()(S,1),i=f[0],C=(0,s.useState)(!1),T=m()(C,2),N=T[0],y=T[1],A=(0,s.useState)(null),p=m()(A,2),I=p[0],j=p[1],d=(0,V.useIntl)(),n=(0,R.L3)(d),Z=_.A.useWatch("instrumentName",i)||R.OG;(0,s.useEffect)(function(){(0,oe.pr)(Z).catch(console.error)},[Z]),(0,s.useEffect)(function(){var g=(0,$.Tp)(R.Ry,null);g&&i.setFieldsValue(g)},[i]);var v=function(M,t){(0,$.pd)(R.Ry,t,d.formatMessage({id:"tone-identification.storage-name"}))},b=function(){var g=q()(z()().mark(function M(t){var o,X,Y,O;return z()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(o=t.toneListGroup,X=t.toneType,Y=t.difficulty,O=[],X==="GuitarChords"?O=o.chords||[]:O=Object.entries(o).filter(function(D){var W=m()(D,1),Q=W[0];return!isNaN(Number(Q))}).map(function(D){var W=m()(D,2),Q=W[1];return Q}).flat().filter(Boolean),!(O.length<Y)){F.next=6;break}return J.ZP.error(d.formatMessage({id:"tone-identification.difficulty-error"},{count:O.length,difficulty:Y})),F.abrupt("return");case 6:j(t),y(!0);case 8:case"end":return F.stop()}},M)}));return function(t){return g.apply(this,arguments)}}();return(0,e.jsxs)("div",{children:[(0,e.jsxs)(_.A,{form:i,initialValues:Ke,onValuesChange:v,onFinish:b,submitter:{searchConfig:{submitText:d.formatMessage({id:"tone-identification.start-test"})},render:function(M,t){return(0,e.jsx)(Oe.S,{children:t})}},children:[(0,e.jsx)(Le.Z,{}),(0,e.jsx)(H.Z,{title:d.formatMessage({id:"tone-identification.test-settings"}),className:"mb-6",children:(0,e.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-4 border-b pb-4",children:[(0,e.jsx)(ee.Z.Group,{name:"instrumentName",label:d.formatMessage({id:"tone-identification.instrument"}),radioType:"button",fieldProps:{buttonStyle:"solid",size:"middle"},options:R.qL.map(function(g){return K()(K()({},g),{},{label:d.formatMessage({id:g.label})})})}),(0,e.jsx)(ee.Z.Group,{name:"difficulty",label:d.formatMessage({id:"tone-identification.difficulty"}),radioType:"button",fieldProps:{buttonStyle:"solid",size:"middle"},options:[{label:d.formatMessage({id:"tone-identification.difficulty.easy"}),value:2},{label:d.formatMessage({id:"tone-identification.difficulty.medium"}),value:4},{label:d.formatMessage({id:"tone-identification.difficulty.hard"}),value:6},{label:d.formatMessage({id:"tone-identification.difficulty.hell"}),value:8}]})]}),(0,e.jsxs)("div",{className:"flex flex-wrap gap-x-8 gap-y-0 border-b pb-4",children:[(0,e.jsx)(le.Z,{name:"toneDuration",label:d.formatMessage({id:"tone-identification.tone-duration"}),min:100,max:5e3,step:100,width:"md",fieldProps:{tooltip:{formatter:n}}}),(0,e.jsx)(le.Z,{name:"toneWait",label:d.formatMessage({id:"tone-identification.tone-wait"}),min:100,max:5e3,step:100,width:"md",fieldProps:{tooltip:{formatter:n}}})]}),(0,e.jsxs)("div",{className:"flex flex-wrap items-center gap-8",children:[(0,e.jsx)(ee.Z.Group,{name:"mode",label:d.formatMessage({id:"tone-identification.mode"}),radioType:"button",fieldProps:{buttonStyle:"solid",size:"middle"},options:[{label:d.formatMessage({id:"tone-identification.mode.infinite"}),value:"infinite"},{label:d.formatMessage({id:"tone-identification.mode.timed"}),value:"timed"}]}),(0,e.jsx)(ze.Z,{name:["mode"],children:function(M){var t=M.mode;return t==="timed"&&(0,e.jsx)(we.Z,{name:"timeLimit",label:d.formatMessage({id:"tone-identification.time-limit"}),width:"xs",min:10,fieldProps:{step:10}})}})]})]})})]}),I&&(0,e.jsx)(Ue,{open:N,settings:I,onCancel:function(){return y(!1)}})]})},Xe=Je,ke=a(43969),qe=a(52402),ne=a(64451),me=a(20293),_e=a(88645),ve=function(S){var f=S.data,i=S.label,C=S.color,T=C===void 0?"":C,N=(0,V.useIntl)();if(f.length===0)return(0,e.jsx)(ke.Z,{description:N.formatMessage({id:"common.no-data"})});var y=600,A=200,p=20,I=y-p*2,j=A-p*2,d=Math.max.apply(Math,te()(f).concat([1])),n=0,Z=d-n,v=f.map(function(b,g){var M=p+g/(f.length-1||1)*I,t=p+j-(b-n)/Z*j;return"".concat(M,",").concat(t)}).join(" ");return(0,e.jsxs)("div",{className:"w-full overflow-x-auto",children:[(0,e.jsx)("div",{className:"font-semibold mb-2",children:i}),(0,e.jsxs)("svg",{width:y,height:A,className:"bg-gray-50 rounded",children:[[0,.25,.5,.75,1].map(function(b){return(0,e.jsx)("line",{x1:p,y1:p+j*b,x2:y-p,y2:p+j*b,stroke:"#e5e7eb",strokeDasharray:"4"},b)}),(0,e.jsx)("polyline",{fill:"none",stroke:T,strokeWidth:"3",strokeLinejoin:"round",points:v}),f.map(function(b,g){var M=p+g/(f.length-1||1)*I,t=p+j-(b-n)/Z*j;return(0,e.jsx)("circle",{cx:M,cy:t,r:"4",fill:T,onMouseEnter:function(){}},g)})]}),(0,e.jsxs)("div",{className:"flex justify-between text-xs text-gray-400 mt-1 px-5",children:[(0,e.jsx)("span",{children:N.formatMessage({id:"common.earlier"})}),(0,e.jsx)("span",{children:N.formatMessage({id:"common.recent"})})]})]})},et=function(){var S=(0,s.useState)(20),f=m()(S,2),i=f[0],C=f[1],T=(0,s.useState)("all"),N=m()(T,2),y=N[0],A=N[1],p=(0,s.useState)("all"),I=m()(p,2),j=I[0],d=I[1],n=(0,V.useIntl)(),Z=(0,s.useMemo)(function(){return fe()},[]),v=(0,s.useMemo)(function(){var t=Z;return y!=="all"&&(t=t.filter(function(o){return o.difficulty===y})),j!=="all"&&(t=t.filter(function(o){return o.mode===j})),t.slice(-i)},[Z,i,y,j]),b=(0,s.useMemo)(function(){return v.length===0?0:v.reduce(function(t,o){return t+o.accuracy},0)/v.length},[v]),g=(0,s.useMemo)(function(){return v.length===0?0:v.reduce(function(t,o){return t+o.avgResponseTime},0)/v.length},[v]),M=function(){Qe(),window.location.reload()};return(0,e.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,e.jsx)(H.Z,{title:n.formatMessage({id:"stats.config"}),size:"small",children:(0,e.jsxs)(qe.Z,{wrap:!0,size:16,children:[(0,e.jsxs)("div",{children:[(0,e.jsxs)("span",{className:"mr-2",children:[n.formatMessage({id:"stats.history-length"}),":"]}),(0,e.jsx)(ne.Z,{value:i,onChange:C,style:{width:140},options:[10,20,50,100].map(function(t){return{label:n.formatMessage({id:"stats.history-length.n"},{n:t}),value:t}})})]}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("span",{className:"mr-2",children:[n.formatMessage({id:"stats.difficulty-filter"}),":"]}),(0,e.jsx)(ne.Z,{value:y,onChange:A,style:{width:140},options:[{label:n.formatMessage({id:"stats.difficulty-all"}),value:"all"},{label:n.formatMessage({id:"option.difficulty.n-choice-1"},{n:2}),value:2},{label:n.formatMessage({id:"option.difficulty.n-choice-1"},{n:4}),value:4},{label:n.formatMessage({id:"option.difficulty.n-choice-1"},{n:6}),value:6},{label:n.formatMessage({id:"option.difficulty.n-choice-1"},{n:8}),value:8}]})]}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("span",{className:"mr-2",children:[n.formatMessage({id:"stats.mode-filter"}),":"]}),(0,e.jsx)(ne.Z,{value:j,onChange:d,style:{width:140},options:[{label:n.formatMessage({id:"stats.mode-all"}),value:"all"},{label:n.formatMessage({id:"tone-identification.mode.timed"}),value:"timed"},{label:n.formatMessage({id:"tone-identification.mode.infinite"}),value:"infinite"}]})]}),(0,e.jsx)(de.ZP,{danger:!0,size:"small",onClick:M,children:n.formatMessage({id:"stats.reset-data"})})]})}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)(H.Z,{size:"small",children:[(0,e.jsx)(me.Z,{title:n.formatMessage({id:"stats.avg-accuracy"}),value:b*100,precision:1,suffix:"%",valueStyle:{color:"#3f8600"}}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(ve,{data:v.map(function(t){return t.accuracy*100}),label:n.formatMessage({id:"stats.accuracy-trend"}),color:"#3f8600"})})]}),(0,e.jsxs)(H.Z,{size:"small",children:[(0,e.jsx)(me.Z,{title:n.formatMessage({id:"stats.avg-response-time"}),value:g,precision:2,suffix:"s",valueStyle:{color:"#1890ff"}}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(ve,{data:v.map(function(t){return t.avgResponseTime}),label:n.formatMessage({id:"stats.response-time-trend"}),color:"#1890ff"})})]})]}),(0,e.jsx)(H.Z,{title:n.formatMessage({id:"stats.detailed-history"}),size:"small",children:(0,e.jsx)(_e.Z,{dataSource:v.map(function(t,o){return K()(K()({},t),{},{key:o})}),columns:[{title:n.formatMessage({id:"table.column.time"}),dataIndex:"timestamp",render:function(o){return new Date(o).toLocaleString()},responsive:["md"]},{title:n.formatMessage({id:"table.column.difficulty"}),dataIndex:"difficulty",render:function(o){return n.formatMessage({id:"option.difficulty.n-choice-1"},{n:o})}},{title:n.formatMessage({id:"table.column.mode"}),dataIndex:"mode",render:function(o){return o==="timed"?n.formatMessage({id:"option.mode.timed.short"}):n.formatMessage({id:"option.mode.infinite.short"})}},{title:n.formatMessage({id:"table.column.score"}),dataIndex:"correctCount"},{title:n.formatMessage({id:"table.column.accuracy"}),dataIndex:"accuracy",render:function(o){return"".concat((o*100).toFixed(0),"%")}},{title:n.formatMessage({id:"table.column.duration"}),dataIndex:"avgResponseTime",render:function(o){return"".concat(o.toFixed(2),"s")}}],pagination:{pageSize:5},size:"small"})})]})},tt=et,at=function(){var S=(0,s.useState)("practice"),f=m()(S,2),i=f[0],C=f[1],T=(0,V.useIntl)();return(0,e.jsxs)(Ge._z,{header:{title:T.formatMessage({id:"menu.instrument.tone-identification"})},tabList:[{tab:T.formatMessage({id:"tone-identification.practice"}),key:"practice"},{tab:T.formatMessage({id:"tone-identification.statistics"}),key:"statistics"}],tabActiveKey:i,onTabChange:C,children:[i==="practice"&&(0,e.jsx)(Xe,{}),i==="statistics"&&(0,e.jsx)(tt,{})]})},nt=at}}]);
