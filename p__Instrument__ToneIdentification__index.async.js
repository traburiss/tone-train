"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[132],{11215:function(dt,ee,t){t.r(ee),t.d(ee,{default:function(){return ke}});var be=t(48305),f=t.n(be),Te=t(5318),s=t(75271),De=t(90228),L=t.n(De),Ee=t(87999),U=t.n(Ee),Ne=t(93043),F=t(89504),w=t(67056),te=t(39420),K=t(40624),Ze=t(21004),J=t(24486),ne=t(84611),Ae=t(97375),Be=t(1501),H=t(30933),W=t(45803),Ie=t(15558),X=t.n(Ie),Pe=t(26007),Re=t(92439),k=t(32401),Ge=t(99430),ae=t(1073),Le=t(45190),re=t(70439),se=t(55248),ie=function(){return(0,w.fy)(F.Ry,[])},Me=function(p){var l=ie();l.push(p),l.length>100&&l.shift(),(0,w._Y)(F.Ry,l,"\u542C\u97F3\u5224\u65AD\u7EDF\u8BA1\u6570\u636E")},Oe=function(){(0,w._Y)(F.Ry,[],"\u542C\u97F3\u5224\u65AD\u7EDF\u8BA1\u6570\u636E")},e=t(52676),M=null,ze=function(p){var l=p.open,a=p.settings,S=p.onCancel,E=(0,s.useState)(null),C=f()(E,2),j=C[0],x=C[1],N=(0,s.useState)([]),y=f()(N,2),T=y[0],D=y[1],Z=(0,s.useState)([]),m=f()(Z,2),o=m[0],g=m[1],v=(0,s.useState)(a.timeLimit),r=f()(v,2),i=r[0],I=r[1],P=(0,s.useState)(0),ce=f()(P,2),R=ce[1],V=(0,s.useState)(0),O=f()(V,2),A=O[0],de=O[1],qe=(0,s.useState)(0),fe=f()(qe,2),$=fe[0],_e=fe[1],et=(0,s.useState)(0),ve=f()(et,2),tt=ve[0],_=ve[1],nt=(0,s.useState)(!1),me=f()(nt,2),at=me[0],he=me[1],rt=(0,s.useState)(!0),xe=f()(rt,2),ge=xe[0],pe=xe[1],ye=(0,s.useRef)(0),je=(0,s.useRef)(0),Q=(0,s.useRef)(null),z=(0,s.useRef)([]),Y=(0,s.useMemo)(function(){var c=a.toneListGroup,u=a.toneType;return u==="GuitarChords"?c.chords||[]:Object.entries(c).filter(function(d){var h=f()(d,1),n=h[0];return!isNaN(Number(n))}).map(function(d){var h=f()(d,2),n=h[1];return n}).flat().filter(Boolean)},[a]),Se=function(){var c=U()(L()().mark(function u(d){var h,n;return L()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(M){b.next=2;break}return b.abrupt("return");case 2:he(!0),h=(a.toneDuration||1e3)/1e3,a.toneType==="GuitarChords"?(n=(0,k.UV)(d),n.length>0?M.triggerAttackRelease(n,h):M.triggerAttackRelease(d,h)):M.triggerAttackRelease(d,h),setTimeout(function(){return he(!1)},h*1e3);case 6:case"end":return b.stop()}},u)}));return function(d){return c.apply(this,arguments)}}(),Fe=function(){if(Y.length===0){H.ZP.error("\u672A\u9009\u62E9\u4EFB\u4F55\u97F3\u9636\u6216\u548C\u5F26"),S();return}var u=Y[Math.floor(Math.random()*Y.length)];x(u),g([]);var d=[u],h=Y.filter(function(b){return b!==u}),n=a.difficulty-1,G=h.sort(function(){return .5-Math.random()});d.push.apply(d,X()(G.slice(0,n))),D(d.sort(function(){return .5-Math.random()})),Se(u),je.current=Date.now()},st=function(){var c=U()(L()().mark(function u(){var d;return L()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return pe(!0),n.prev=1,n.next=4,(0,te.pr)(a.instrumentName);case 4:d=n.sent,M=d,n.next=12;break;case 8:n.prev=8,n.t0=n.catch(1),console.error("Failed to load instrument, falling back to PolySynth",n.t0),M=new se.v2(se.WV).toDestination();case 12:pe(!1),Fe();case 14:case"end":return n.stop()}},u,null,[[1,8]])}));return function(){return c.apply(this,arguments)}}(),it=function(u){if(u===j){var d=(Date.now()-je.current)/1e3;z.current.push({timeTaken:d,correct:o.length===0}),R(function(n){return n+1}),_e(function(n){return n+1}),de(function(n){return n+1});var h=o.length===0;_(h?function(n){var G=n+1;return G%3===0&&a.mode==="timed"&&(I(function(b){return b+5}),H.ZP.success("\u8FDE\u5BF93\u6B21\uFF0C\u65F6\u95F4+5s\uFF01")),G}:0),setTimeout(Fe,a.toneWait||0)}else o.includes(u)||(g(function(n){return[].concat(X()(n),[u])}),de(function(n){return n+1}),_(0))},Ce=function(){if(z.current.length===0)return null;var u=(Date.now()-ye.current)/1e3,d=A>0?$/A:0,h=z.current.reduce(function(G,b){return G+b.timeTaken},0)/z.current.length,n={timestamp:Date.now(),difficulty:a.difficulty,mode:a.mode,correctCount:$,totalQuestions:z.current.length,accuracy:d,avgResponseTime:h,duration:u};return Me(n),{accuracy:d,avgResponseTime:h}},ut=function(){var u=Ce();if(!u){S();return}ae.Z.info({title:"\u6D4B\u8BD5\u7ED3\u675F",content:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{children:["\u6B63\u786E\u6570\u91CF: ",$]}),(0,e.jsxs)("p",{children:["\u51C6\u786E\u7387: ",(u.accuracy*100).toFixed(1),"%"]}),(0,e.jsxs)("p",{children:["\u5E73\u5747\u7528\u65F6: ",u.avgResponseTime.toFixed(2),"s"]})]}),onOk:S})},lt=function(){z.current.length>0&&(Ce(),H.ZP.info("\u6D4B\u8BD5\u5DF2\u4E2D\u65AD\uFF0C\u8FDB\u5EA6\u5DF2\u8BB0\u5F55")),S()};(0,s.useEffect)(function(){return l&&(st(),ye.current=Date.now(),a.mode==="timed"&&(I(a.timeLimit),Q.current=setInterval(function(){I(function(c){return c<=1?(clearInterval(Q.current),ut(),0):c-1})},1e3))),function(){Q.current&&clearInterval(Q.current)}},[l]);var ot=(0,Re.u)(a.instrumentName),ct=ot.status;return(0,e.jsx)(ae.Z,{open:l,onCancel:lt,footer:null,width:700,title:(0,e.jsxs)("div",{className:"flex justify-between items-center pr-8",children:[(0,e.jsxs)("span",{children:["\u542C\u97F3\u5224\u65AD - ",a.mode==="timed"?"\u9650\u65F6\u6311\u6218":"\u65E0\u9650\u6A21\u5F0F"]}),a.mode==="timed"&&(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsxs)("span",{className:i<10?"text-red-500 font-bold":"",children:["\u5012\u8BA1\u65F6: ",i,"s"]}),(0,e.jsx)(Le.Z,{type:"circle",percent:i/a.timeLimit*100,size:{width:30},showInfo:!1,strokeColor:i<10?"#ff4d4f":"#1890ff"})]})]}),maskClosable:!1,destroyOnHidden:!0,children:(0,e.jsxs)("div",{className:"py-4 text-center",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)(re.ZP,{type:"primary",shape:"round",icon:(0,e.jsx)(Ge.Z,{}),size:"large",onClick:function(){return j&&Se(j)},loading:at||ge,children:"\u91CD\u653E\u58F0\u97F3"}),(0,e.jsx)("div",{className:"mt-2 text-gray-400 text-xs",children:ge?"\u6B63\u5728\u51C6\u5907\u97F3\u8272...":ct==="loaded"?"\u97F3\u8272\u5DF2\u5C31\u7EEA":"\u97F3\u8272\u52A0\u8F7D\u4E2D\uFF0C\u6682\u7528\u6A21\u62DF\u97F3"})]}),(0,e.jsx)("div",{className:"grid gap-2 mb-6",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:T.map(function(c){var u=o.includes(c),d=a.toneType==="GuitarChords";return(0,e.jsxs)("div",{className:`
                  flex flex-col items-center justify-center p-0.5 border rounded transition-all cursor-pointer select-none
                  h-24 overflow-hidden
                  `.concat(u?"bg-gray-50 border-gray-100 opacity-10 cursor-not-allowed":"bg-white border-blue-50 shadow-sm hover:border-blue-300 active:scale-95",`
                `),onClick:function(){return!u&&it(c)},children:[(0,e.jsx)("div",{className:"font-bold truncate w-full text-center leading-tight ".concat(d?"text-[10px] text-gray-400":"text-sm text-gray-700"),children:c}),k.YD[c]&&(0,e.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,e.jsx)(Pe.Z,{name:c,fingering:k.YD[c],width:60,height:80,showName:!1})})]},c)})}),(0,e.jsxs)("div",{className:"flex justify-between text-gray-500 border-t pt-4",children:[(0,e.jsxs)("span",{children:["\u6B63\u786E\u6B21\u6570: ",$]}),(0,e.jsxs)("span",{children:["\u8FDE\u5BF9\u5956\u52B1: ",tt]}),(0,e.jsxs)("span",{children:["\u51C6\u786E\u7387:"," ",A>0?($/A*100).toFixed(0):0,"%"]})]})]})})},we=ze,We={toneType:F.W4,instrumentName:F.OG,toneListGroup:{chords:["C","D","G","Em","Am"]},difficulty:2,mode:"timed",timeLimit:60,toneDuration:1e3,toneWait:1500},Ve=function(){var p=K.A.useForm(),l=f()(p,1),a=l[0],S=(0,s.useState)(!1),E=f()(S,2),C=E[0],j=E[1],x=(0,s.useState)(null),N=f()(x,2),y=N[0],T=N[1],D=K.A.useWatch("instrumentName",a)||F.OG;(0,s.useEffect)(function(){(0,te.pr)(D).catch(console.error)},[D]),(0,s.useEffect)(function(){var o=(0,w.Tp)(F.Ry,null);o&&a.setFieldsValue(o)},[a]);var Z=function(g,v){(0,w.pd)(F.Ry,v,"\u542C\u97F3\u5224\u65AD\u914D\u7F6E")},m=function(){var o=U()(L()().mark(function g(v){var r,i,I,P;return L()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(r=v.toneListGroup,i=v.toneType,I=v.difficulty,P=[],i==="GuitarChords"?P=r.chords||[]:P=Object.entries(r).filter(function(V){var O=f()(V,1),A=O[0];return!isNaN(Number(A))}).map(function(V){var O=f()(V,2),A=O[1];return A}).flat().filter(Boolean),!(P.length<I)){R.next=6;break}return H.ZP.error("\u5F53\u524D\u9009\u62E9\u7684\u97F3\u7B26/\u548C\u5F26\u6570\u91CF (".concat(P.length,") \u4E0D\u8DB3\uFF0C\u81F3\u5C11\u9700\u8981\u9009\u62E9 ").concat(I," \u4E2A\u624D\u80FD\u5F00\u59CB\u5F53\u524D\u96BE\u5EA6\u7684\u6D4B\u8BD5\u3002")),R.abrupt("return");case 6:T(v),j(!0);case 8:case"end":return R.stop()}},g)}));return function(v){return o.apply(this,arguments)}}();return(0,e.jsxs)("div",{children:[(0,e.jsxs)(K.A,{form:a,initialValues:We,onValuesChange:Z,onFinish:m,submitter:{searchConfig:{submitText:"\u5F00\u59CB\u6D4B\u8BD5"},render:function(g,v){return(0,e.jsx)(Ze.S,{children:v})}},children:[(0,e.jsx)(Ne.Z,{}),(0,e.jsx)(W.Z,{title:"\u6D4B\u8BD5\u914D\u7F6E",className:"mb-6",children:(0,e.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-4 border-b pb-4",children:[(0,e.jsx)(J.Z.Group,{name:"instrumentName",label:"\u4E50\u5668\u97F3\u8272",radioType:"button",fieldProps:{buttonStyle:"solid",size:"small"},options:F.qL}),(0,e.jsx)(J.Z.Group,{name:"difficulty",label:"\u95EE\u9898\u96BE\u5EA6",radioType:"button",fieldProps:{buttonStyle:"solid",size:"small"},options:[{label:"\u7B80\u5355 (2\u90091)",value:2},{label:"\u4E2D\u7B49 (4\u90091)",value:4},{label:"\u56F0\u96BE (6\u90091)",value:6},{label:"\u5730\u72F1 (8\u90091)",value:8}]})]}),(0,e.jsxs)("div",{className:"flex flex-wrap gap-x-8 gap-y-0 border-b pb-4",children:[(0,e.jsx)(ne.Z,{name:"toneDuration",label:"\u97F3\u64AD\u653E\u65F6\u957F",min:100,max:5e3,step:100,width:"md",fieldProps:{tooltip:{formatter:F.QZ}}}),(0,e.jsx)(ne.Z,{name:"toneWait",label:"\u97F3\u64AD\u653E\u5B8C\u7B49\u5F85\u65F6\u957F",min:100,max:5e3,step:100,width:"md",fieldProps:{tooltip:{formatter:F.QZ}}})]}),(0,e.jsxs)("div",{className:"flex flex-wrap items-center gap-8",children:[(0,e.jsx)(J.Z.Group,{name:"mode",label:"\u6D4B\u8BD5\u6A21\u5F0F",radioType:"button",fieldProps:{buttonStyle:"solid",size:"small"},options:[{label:"\u9650\u65F6\u6311\u6218",value:"timed"},{label:"\u65E0\u9650\u6A21\u5F0F",value:"infinite"}]}),(0,e.jsx)(Ae.Z,{name:["mode"],children:function(g){var v=g.mode;return v==="timed"&&(0,e.jsx)(Be.Z,{name:"timeLimit",label:"\u65F6\u95F4\u4E0A\u9650 (\u79D2)",width:"xs",min:10,fieldProps:{step:30}})}})]})]})})]}),y&&(0,e.jsx)(we,{open:C,settings:y,onCancel:function(){return j(!1)}})]})},$e=Ve,He=t(26068),ue=t.n(He),Qe=t(43969),Ye=t(52402),q=t(64451),le=t(20293),Ue=t(88645),oe=function(p){var l=p.data,a=p.label,S=p.color,E=S===void 0?"":S;if(l.length===0)return(0,e.jsx)(Qe.Z,{description:"\u6682\u65E0\u6570\u636E"});var C=600,j=200,x=20,N=C-x*2,y=j-x*2,T=Math.max.apply(Math,X()(l).concat([1])),D=0,Z=T-D,m=l.map(function(o,g){var v=x+g/(l.length-1||1)*N,r=x+y-(o-D)/Z*y;return"".concat(v,",").concat(r)}).join(" ");return(0,e.jsxs)("div",{className:"w-full overflow-x-auto",children:[(0,e.jsx)("div",{className:"font-semibold mb-2",children:a}),(0,e.jsxs)("svg",{width:C,height:j,className:"bg-gray-50 rounded",children:[[0,.25,.5,.75,1].map(function(o){return(0,e.jsx)("line",{x1:x,y1:x+y*o,x2:C-x,y2:x+y*o,stroke:"#e5e7eb",strokeDasharray:"4"},o)}),(0,e.jsx)("polyline",{fill:"none",stroke:E,strokeWidth:"3",strokeLinejoin:"round",points:m}),l.map(function(o,g){var v=x+g/(l.length-1||1)*N,r=x+y-(o-D)/Z*y;return(0,e.jsx)("circle",{cx:v,cy:r,r:"4",fill:E,onMouseEnter:function(){}},g)})]}),(0,e.jsxs)("div",{className:"flex justify-between text-xs text-gray-400 mt-1 px-5",children:[(0,e.jsx)("span",{children:"\u8F83\u65E9"}),(0,e.jsx)("span",{children:"\u6700\u8FD1"})]})]})},Ke=function(){var p=(0,s.useState)(20),l=f()(p,2),a=l[0],S=l[1],E=(0,s.useState)("all"),C=f()(E,2),j=C[0],x=C[1],N=(0,s.useState)("all"),y=f()(N,2),T=y[0],D=y[1],Z=(0,s.useMemo)(function(){return ie()},[]),m=(0,s.useMemo)(function(){var r=Z;return j!=="all"&&(r=r.filter(function(i){return i.difficulty===j})),T!=="all"&&(r=r.filter(function(i){return i.mode===T})),r.slice(-a)},[Z,a,j,T]),o=(0,s.useMemo)(function(){return m.length===0?0:m.reduce(function(r,i){return r+i.accuracy},0)/m.length},[m]),g=(0,s.useMemo)(function(){return m.length===0?0:m.reduce(function(r,i){return r+i.avgResponseTime},0)/m.length},[m]),v=function(){Oe(),window.location.reload()};return(0,e.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,e.jsx)(W.Z,{title:"\u7EDF\u8BA1\u914D\u7F6E",size:"small",children:(0,e.jsxs)(Ye.Z,{wrap:!0,size:16,children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"mr-2",children:"\u5386\u53F2\u957F\u5EA6:"}),(0,e.jsx)(q.Z,{value:a,onChange:S,style:{width:100},options:[{label:"\u6700\u8FD110\u6B21",value:10},{label:"\u6700\u8FD120\u6B21",value:20},{label:"\u6700\u8FD150\u6B21",value:50},{label:"\u6700\u8FD1100\u6B21",value:100}]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"mr-2",children:"\u96BE\u5EA6\u7B5B\u9009:"}),(0,e.jsx)(q.Z,{value:j,onChange:x,style:{width:120},options:[{label:"\u5168\u90E8\u96BE\u5EA6",value:"all"},{label:"\u7B80\u5355 (2)",value:2},{label:"\u4E2D\u7B49 (4)",value:4},{label:"\u56F0\u96BE (6)",value:6},{label:"\u5730\u72F1 (8)",value:8}]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"mr-2",children:"\u6A21\u5F0F\u7B5B\u9009:"}),(0,e.jsx)(q.Z,{value:T,onChange:D,style:{width:120},options:[{label:"\u5168\u90E8\u6A21\u5F0F",value:"all"},{label:"\u9650\u65F6\u6311\u6218",value:"timed"},{label:"\u65E0\u9650\u6A21\u5F0F",value:"infinite"}]})]}),(0,e.jsx)(re.ZP,{danger:!0,size:"small",onClick:v,children:"\u91CD\u7F6E\u6240\u6709\u6570\u636E"})]})}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)(W.Z,{size:"small",children:[(0,e.jsx)(le.Z,{title:"\u5E73\u5747\u51C6\u786E\u7387",value:o*100,precision:1,suffix:"%",valueStyle:{color:"#3f8600"}}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(oe,{data:m.map(function(r){return r.accuracy*100}),label:"\u51C6\u786E\u7387\u8D8B\u52BF (%)",color:"#3f8600"})})]}),(0,e.jsxs)(W.Z,{size:"small",children:[(0,e.jsx)(le.Z,{title:"\u5E73\u5747\u53CD\u5E94\u65F6\u95F4",value:g,precision:2,suffix:"s",valueStyle:{color:"#1890ff"}}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(oe,{data:m.map(function(r){return r.avgResponseTime}),label:"\u53CD\u5E94\u65F6\u95F4\u8D8B\u52BF (\u79D2)",color:"#1890ff"})})]})]}),(0,e.jsx)(W.Z,{title:"\u8BE6\u7EC6\u5386\u53F2",size:"small",children:(0,e.jsx)(Ue.Z,{dataSource:m.map(function(r,i){return ue()(ue()({},r),{},{key:i})}),columns:[{title:"\u65F6\u95F4",dataIndex:"timestamp",render:function(i){return new Date(i).toLocaleString()},responsive:["md"]},{title:"\u96BE\u5EA6",dataIndex:"difficulty",render:function(i){return"".concat(i,"\u90091")}},{title:"\u6A21\u5F0F",dataIndex:"mode",render:function(i){return i==="timed"?"\u9650\u65F6":"\u65E0\u9650"}},{title:"\u5F97\u5206",dataIndex:"correctCount"},{title:"\u51C6\u786E\u7387",dataIndex:"accuracy",render:function(i){return"".concat((i*100).toFixed(0),"%")}},{title:"\u8017\u65F6",dataIndex:"avgResponseTime",render:function(i){return"".concat(i.toFixed(2),"s")}}],pagination:{pageSize:5},size:"small"})})]})},Je=Ke,Xe=function(){var p=(0,s.useState)("practice"),l=f()(p,2),a=l[0],S=l[1];return(0,e.jsxs)(Te._z,{header:{title:"\u542C\u97F3\u5224\u65AD"},tabList:[{tab:"\u529F\u80FD\u7EC3\u4E60",key:"practice"},{tab:"\u7EDF\u8BA1\u5206\u6790",key:"statistics"}],tabActiveKey:a,onTabChange:S,children:[a==="practice"&&(0,e.jsx)($e,{}),a==="statistics"&&(0,e.jsx)(Je,{})]})},ke=Xe}}]);
